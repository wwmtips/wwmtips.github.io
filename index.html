<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì—°ìš´íŒìŠ¤</title>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5SMVDZTDST"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-5SMVDZTDST');
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" sizes="32x32" href="fav/favicon-32x32.png">

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#3182f6', bgMain: '#f2f4f6' }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f2f4f6; color: #191f28; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .nav-item.active { @apply text-gray-900; }
        .nav-item.active svg { @apply stroke-gray-900 stroke-2; }
        .quiz-row:hover { background-color: #f8fafc; }
        .show { display: block !important; }
        .rank-card { @apply flex flex-col items-center justify-center bg-white border border-gray-100 rounded-xl p-3 min-w-[80px] shadow-sm; }
        .rank-badge { @apply w-5 h-5 rounded-full flex items-center justify-center text-[10px] font-bold text-white mb-1; }
    </style>
</head>

<body class="pb-24">
    <script src="calc.js"></script>
    <script src="hw.js"></script>
    <script src="script.js"></script>
    <script src="timer.js"></script>

    <div id="sidebar-overlay" onclick="closeSidebar()" class="fixed inset-0 bg-black/40 z-[2999] hidden backdrop-blur-sm transition-opacity"></div>

    <header class="sticky top-0 z-50 bg-white h-[60px] lg:h-[72px] flex items-center px-3 lg:px-8 gap-4 border-b border-gray-100 transition-all duration-300 shadow-sm">
        <div class="lg:block font-black text-xl text-blue-600 cursor-pointer flex-none" onclick="switchTab('home')">ì—°ìš´íˆ´ì¦ˆ</div>

        <nav class="hidden lg:flex items-center gap-6 text-sm font-bold text-gray-500 ml-auto">
            <button onclick="switchTab('home')" id="pc-nav-home" class="hover:text-blue-600 transition-colors nav-item active">ìŠ¤ë¬´ê³ ê°œ</button>
            <button onclick="switchTab('quest')" id="pc-nav-quest" class="hover:text-blue-600 transition-colors nav-item">ë¬´ë¦¼ë¡</button>
            <button onclick="switchTab('chunji')" id="pc-nav-chunji" class="hover:text-blue-600 transition-colors nav-item">ì²œì§€ë¡</button>
            <button onclick="switchTab('todo')" id="pc-nav-todo" class="hover:text-blue-600 transition-colors nav-item">í•  ì¼</button>
        </nav>

        <button onclick="toggleSidebar()" class="w-10 h-10 lg:hidden ml-auto flex items-center justify-center text-gray-800 cursor-pointer hover:bg-gray-50 rounded-full transition-colors flex-none">
            <svg class="w-7 h-7" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>
    </header>

    <aside id="main-sidebar" class="fixed top-0 right-[-100%] w-full max-w-[320px] h-full bg-white z-[3000] flex flex-col transition-[right] duration-300 ease-in-out shadow-2xl">
        <div class="p-5 border-b border-gray-100 flex justify-between items-center">
            <span class="text-[11px] font-black text-gray-400 uppercase tracking-widest">ë°”ë¡œê°€ê¸°</span>
            <button class="w-8 h-8 flex items-center justify-center text-gray-400" onclick="closeSidebar()">âœ•</button>
        </div>
        <div class="flex-1 overflow-y-auto p-5 space-y-4">
            <div class="flex items-center gap-3 text-[16px] font-bold text-gray-800 cursor-pointer" onclick="switchTab('home'); closeSidebar();">ìŠ¤ë¬´ê³ ê°œ (í™ˆ)</div>
            <div class="flex items-center gap-3 text-[16px] font-bold text-gray-800 cursor-pointer" onclick="switchTab('quest'); closeSidebar();">ë¬´ë¦¼ë¡</div>
            <div class="flex items-center gap-3 text-[16px] font-bold text-gray-800 cursor-pointer" onclick="switchTab('chunji'); closeSidebar();">ì²œì§€ë¡</div>
            <div class="flex items-center gap-3 text-[16px] font-bold text-gray-800 cursor-pointer" onclick="switchTab('todo'); closeSidebar();">ìˆ™ì œ íƒ€ì´ë¨¸</div>
        </div>
    </aside>

    <main id="main-content" class="mx-auto lg:max-w-screen-xl lg:px-6 transition-all duration-300">
        
        <div id="view-home" class="pb-10 lg:pb-20 p-5">
            <div class="max-w-3xl mx-auto">
                
                <div id="quiz-ranking-container" class="mb-6 overflow-x-auto no-scrollbar py-2">
                    </div>

                <div id="quiz-counter-area" class="text-xs text-gray-400 mb-2 text-right">
                    ë°ì´í„° ë¡œë”© ì¤‘...
                </div>

                <div class="relative mb-6">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </div>
                    <input type="text" id="quiz-local-search"
                        class="w-full bg-white border-2 border-blue-100 text-gray-900 text-sm rounded-xl focus:ring-blue-500 focus:border-blue-500 block pl-10 p-4 shadow-sm outline-none transition-all placeholder-gray-400 font-bold"
                        placeholder="ë‹¨ì„œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê°€ì‹œ, ë‘¥ê·¼)">
                </div>

                <div class="bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-gray-500 uppercase bg-gray-50 border-b border-gray-100">
                            <tr>
                                <th scope="col" class="px-2 lg:px-4 py-3 w-[32%]">ë‹¨ì„œ</th>
                                <th scope="col" class="px-2 lg:px-4 py-3 w-[40%]">ì •ë‹µ</th>
                                <th scope="col" class="px-2 lg:px-4 py-3 w-[28%] text-right">ì œë³´</th>
                            </tr>
                        </thead>
                        <tbody id="quiz-table-body" class="divide-y divide-gray-100">
                            </tbody>
                    </table>
                </div>

                <div class="mt-8 text-center">
                    <button onclick="window.open('https://open.kakao.com/o/sXW3q9bg', '_blank')" class="text-xs text-gray-400 underline hover:text-gray-600">
                        ì°¾ëŠ” ì •ë‹µì´ ì—†ë‚˜ìš”? ì œë³´í•˜ëŸ¬ ê°€ê¸°
                    </button>
                </div>
            </div>
        </div>

        <div id="view-todo" style="display: none;" class="p-5">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-900">í•  ì¼</h2>
                <span id="server-time" class="text-xs font-mono bg-white border border-gray-200 px-2 py-1 rounded text-gray-500">00:00:00</span>
            </div>
            <div id="gangho-timer-list-tab" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
        </div>

        <div id="view-quest" style="display: none;" class="p-5">
            <div id="quest-list-view">
                <div class="flex gap-2 mb-4 overflow-x-auto no-scrollbar">
                    <select id="quest-type-select" class="bg-white border border-gray-200 text-sm p-2 rounded-lg outline-none" onchange="onQuestTypeChange()">
                        <option value="all">ì „ì²´</option>
                        <option value="ë§Œì‚¬ë¡">ë§Œì‚¬ë¡</option>
                        <option value="ì¸ì—°ì˜ ê¶¤ì ">ì¸ì—°ì˜ ê¶¤ì </option>
                        <option value="íƒìƒ‰">íƒìƒ‰</option>
                        <option value="í™”ê°„ì§‘">í™”ê°„ì§‘</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                    <select id="quest-location-select" class="bg-white border border-gray-200 text-sm p-2 rounded-lg outline-none" onchange="applyQuestFilter()">
                        <option value="all">ì§€ì—­</option>
                    </select>
                </div>
                <div id="quest-grid-container" class="space-y-3 lg:space-y-0 lg:grid lg:grid-cols-2 lg:gap-4"></div>
                <div id="pagination-container" class="flex justify-center gap-2 mt-8 pb-10"></div>
            </div>
            <div id="quest-detail-view" style="display:none;">
                <button onclick="showQuestList()" class="mb-4 text-sm font-bold text-blue-600 flex items-center">â† ëª©ë¡ìœ¼ë¡œ</button>
                <div id="quest-content-loader" class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm min-h-[200px]"></div>
            </div>
        </div>

        <div id="view-chunji" style="display: none;" class="p-5">
            <div id="chunji-list-view">
                <div class="flex gap-2 mb-4">
                    <select id="chunji-type-select" class="bg-white border border-gray-200 text-sm p-2 rounded-lg outline-none" onchange="onChunjiTypeChange()">
                        <option value="all">ì „ì²´</option>
                    </select>
                    <select id="chunji-subtype-select" class="bg-white border border-gray-200 text-sm p-2 rounded-lg outline-none" onchange="applyChunjiFilter()">
                        <option value="all">ëª¨ë“  í•­ëª©</option>
                    </select>
                </div>
                <div id="chunji-list-container" class="space-y-3 pb-10 lg:space-y-0 lg:grid lg:grid-cols-2 lg:gap-4"></div>
                <div id="chunji-pagination-container" class="flex justify-center gap-2 mt-8 pb-10"></div>
            </div>
            <div id="chunji-detail-view" style="display:none;">
                <button onclick="showChunjiList()" class="mb-4 text-sm font-bold text-blue-600 flex items-center">â† ëª©ë¡ìœ¼ë¡œ</button>
                <div id="chunji-detail-content" class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm min-h-[200px]"></div>
            </div>
        </div>

        <div id="view-guide" style="display: none;" class="p-5">
            <div id="guide-content-loader"></div>
            <div id="guide-dynamic-content" class="bg-white rounded-xl p-5 border border-gray-100"></div>
        </div>
    </main>

    <nav class="lg:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 h-[60px] flex justify-between items-center px-6 z-50">
        <button id="nav-home" onclick="switchTab('home')" class="nav-item active flex flex-col items-center justify-center w-14 gap-1 text-gray-400">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <span class="text-[10px] font-bold">ìŠ¤ë¬´ê³ ê°œ</span>
        </button>
              <button id="nav-todo" onclick="switchTab('todo')" class="nav-item flex flex-col items-center justify-center w-14 gap-1 text-gray-400">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
            </svg>
            <span class="text-[10px] font-bold">í•  ì¼</span>
        </button>
      
        <button id="nav-quest" onclick="switchTab('quest')" class="nav-item flex flex-col items-center justify-center w-14 gap-1 text-gray-400">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <span class="text-[10px] font-bold">ë¬´ë¦¼ë¡</span>
        </button>
        <button id="nav-chunji" onclick="switchTab('chunji')" class="nav-item flex flex-col items-center justify-center w-14 gap-1 text-gray-400">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 21v-8a2 2 0 012-2h14a2 2 0 012 2v8M12 3v18"></path>
            </svg>
            <span class="text-[10px] font-bold">ì²œì§€ë¡</span>
        </button>

    </nav>

    <div id="timer-sheet-modal" class="fixed inset-0 z-[9999] hidden backdrop-blur-sm transition-opacity">
        <div class="absolute inset-0 bg-black/50" onclick="closeTimerSheet()"></div>
        <div class="absolute bottom-0 w-full bg-white rounded-t-2xl p-6 shadow-2xl transition-transform duration-300">
            <div id="timer-detail-content"></div>
        </div>
    </div>

    <div id="report-sheet-modal" class="fixed inset-0 z-[9999] hidden">
        <div class="absolute inset-0 bg-black/50 transition-opacity" onclick="closeReportSheet()"></div>
        <div class="absolute bottom-0 w-full bg-white rounded-t-2xl p-6 transition-transform transform translate-y-full duration-300 ease-out">
            <div class="w-10 h-1 bg-gray-300 rounded-full mx-auto mb-6"></div>
            <div class="bg-gray-50 p-4 rounded-xl mb-4 text-sm text-gray-600">ì˜¤ë¥˜ ì œë³´ëŠ” ì–¸ì œë‚˜ í™˜ì˜í•©ë‹ˆë‹¤.</div>
            <button onclick="window.open('https://open.kakao.com/o/sXW3q9bg', '_blank')"
                class="w-full py-4 bg-yellow-300 rounded-xl font-bold text-gray-900">ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì œë³´í•˜ê¸°</button>
        </div>
    </div>

    <script>
        // [1] ì‚¬ì´ë“œë°” ì œì–´
        function toggleSidebar() {
            const sb = document.getElementById('main-sidebar');
            const ol = document.getElementById('sidebar-overlay');
            if (sb && ol) { sb.style.right = '0'; ol.classList.remove('hidden'); document.body.style.overflow = 'hidden'; }
        }
        function closeSidebar() {
            const sb = document.getElementById('main-sidebar');
            const ol = document.getElementById('sidebar-overlay');
            if (sb && ol) { sb.style.right = '-100%'; ol.classList.add('hidden'); document.body.style.overflow = ''; }
        }

        // [2] íƒ­ ì „í™˜
        window.switchTab = function (tabName, updateHistory = true) {
            const urlMapping = {
                'home': '', 'quiz': '', 
                'quest': 'quest', 'chunji': 'chunji', 'hw': 'hw', 'todo': 'hw'
            };
            const targetParam = urlMapping[tabName] || tabName;
            
            const views = ['view-home', 'view-quest', 'view-chunji', 'view-todo', 'view-guide'];
            views.forEach(v => {
                const el = document.getElementById(v);
                if (!el) return;
                const isTarget = (v === 'view-' + tabName) || 
                               (tabName === 'quiz' && v === 'view-home') ||
                               (tabName === 'hw' && v === 'view-todo') ||
                               (tabName === 'todo' && v === 'view-todo');
                el.style.display = isTarget ? 'block' : 'none';
            });

            updateNavUI(tabName === 'hw' ? 'todo' : (tabName === 'quiz' ? 'home' : tabName));

            if (updateHistory) {
                let newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
                if (targetParam && targetParam !== 'home') newUrl += '?tab=' + targetParam;
                window.history.pushState({ tab: tabName }, '', newUrl);
            }
            window.scrollTo(0, 0);
            
            if (tabName === 'hw' || tabName === 'todo') updateTimers();
        };

        function updateNavUI(activeTab) {
            const pcNavIds = ['pc-nav-home', 'pc-nav-quest', 'pc-nav-chunji', 'pc-nav-todo'];
            pcNavIds.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                const isMatch = id === 'pc-nav-' + activeTab;
                el.classList.toggle('text-blue-600', isMatch);
                el.classList.toggle('active', isMatch);
                el.classList.toggle('text-gray-500', !isMatch);
            });
            const navIds = ['nav-home', 'nav-quest', 'nav-chunji', 'nav-todo'];
            navIds.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                const isMatch = id === 'nav-' + activeTab;
                el.classList.toggle('active', isMatch);
                el.classList.toggle('text-gray-400', !isMatch);
            });
        }

        // [3] ìˆ™ì œ ë°ì´í„°
        const LOCAL_TASK_DATA = [
            { id: 'm_1', freq: 'monthly', type: 'êµ¬ë§¤', loc: 'ê³µëª…ìƒì ', title: 'ìŒì˜ ì„ ìœ¨ êµ¬ë§¤' },
            { id: 'm_2', freq: 'monthly', type: 'êµ¬ë§¤', loc: 'ê³µëª…ìƒì ', title: 'ì„ ìœ¨ í• ì¸ê¶Œ êµ¬ë§¤' },
            { id: 'w_7', freq: 'weekly', type: 'ì „íˆ¬', loc: 'í˜‘ê²½', title: 'í˜‘ê²½ í´ë¦¬ì–´' },
            { id: 'w_8', freq: 'weekly', type: 'ì „íˆ¬', loc: 'ê²€ë¬´ì¥', title: 'ê²€ë¬´ì¥ í´ë¦¬ì–´' },
            { id: 'w_1', freq: 'weekly', type: 'êµ¬ë§¤', loc: 'ê°•í˜¸ë°±ì§„', title: 'ìŒì˜ ì„ ìœ¨ êµ¬ë§¤' },
            { id: 'w_5', freq: 'weekly', type: 'êµ¬ë§¤', loc: 'ì‹œì¦Œìƒì ', title: 'ìŒì˜ ì„ ìœ¨ êµ¬ë§¤' },
            { id: 'w_2', freq: 'weekly', type: 'êµ¬ë§¤', loc: 'ì‹œì¦Œìƒì ', title: 'ì‹¬ë²• ì‹¬ë“ ìƒì êµ¬ë§¤' },
            { id: 'w_3', freq: 'weekly', type: 'êµ¬ë§¤', loc: 'ì‹œì¦Œìƒì ', title: 'ë¹„ê²° ì§€ì› ìƒì êµ¬ë§¤' },
            { id: 'w_4', freq: 'weekly', type: 'êµ¬ë§¤', loc: 'ì‹œì¦Œìƒì ', title: 'ì‘ì€ ë‹¨ë°±ì „ ìƒì êµ¬ë§¤' },
            { id: 'w_6', freq: 'weekly', type: 'êµ¬ë§¤', loc: 'ê°•í˜¸ë ¹ ìƒì ', title: 'ë¹„ê²° ì§€ì› ìƒì êµ¬ë§¤' },
            { id: 'w_9', freq: 'weekly', type: 'í™œë™', loc: 'ë™ë§¹', title: 'í™”ë¬¼ ìš´ì†¡' },
            { id: 'w_13', freq: 'weekly', type: 'í™œë™', loc: 'ë¬´ì—­', title: 'ì‹œë§¤ì‚¬ êµí™˜' },
            { id: 'w_10', freq: 'weekly', type: 'êµ¬ë§¤', loc: 'ì‹œì¦Œìƒì ', title: 'ê¸°ìˆ  í•„ê¸° êµ¬ë§¤' },
            { id: 'w_11', freq: 'weekly', type: 'êµ¬ë§¤', loc: 'ê¸°ìˆ ì–‘ì„±', title: 'ê¸°ìˆ  ì„ íƒ ìƒì êµ¬ë§¤' },
            { id: 'w_12', freq: 'weekly', type: 'êµ¬ë§¤', loc: 'ì‹¬ë“êµí™˜', title: 'ì‹¬ë²• ì„ íƒ ìƒì êµ¬ë§¤' },
            { id: 'w_13', freq: 'weekly', type: 'êµ¬ë§¤', loc: 'ìœ íŒŒì‹œë ¨', title: 'ì‹¬ë²•/ë¹„ê²° ìƒì êµ¬ë§¤' },
            { id: 'd_2', freq: 'daily', type: 'í™œë™', loc: 'í˜„ìƒë ¹', title: 'ìˆ˜ë°°/ë³µìˆ˜ í˜„ìƒë ¹' },
            { id: 'd_4', freq: 'daily', type: 'í™œë™', loc: 'ê¿ˆì†', title: 'ì—½ë¹„íœ´ì˜ ë„ë°• ìƒê¸°íŒ' },
            { id: 'd_5', freq: 'daily', type: 'í™œë™', loc: 'í•„ë“œ', title: 'ë¹„ê²° ì¬ë£Œ ì±„ì§‘' },
            { id: 'd_6', freq: 'daily', type: 'í™œë™', loc: 'í•„ë“œ', title: 'ì•¼ìƒë§ˆ í¬íš' },
            { id: 'd_7', freq: 'daily', type: 'í™œë™', loc: 'ê³µë•ì§€', title: 'ë™ì „ ë˜ì§€ê³  ì†Œì› ë¹Œê¸°' },
            { id: 'd_3', freq: 'daily', type: 'í™œë™', loc: 'ê°•í˜¸í˜¸ë ¹', title: 'ë¬¸íŒŒ í˜¸ë ¹' }
        ];

        window.toggleTaskCheck = function (taskId) {
            const statusData = (typeof getChecklistStatus === 'function') ? getChecklistStatus() : { checked: {} };
            if (statusData.checked[taskId]) delete statusData.checked[taskId];
            else statusData.checked[taskId] = true;

            if (typeof saveChecklistStatus === 'function') saveChecklistStatus(statusData);
            else localStorage.setItem('wwm_checklist_v3', JSON.stringify(statusData)); 

            updateTimers(); 
        };

        // [4] ë°”í…€ ì‹œíŠ¸
        window.openTimerSheetByName = function (name) {
            if (typeof TIMERS === 'undefined') return;
            const timer = TIMERS.find(x => x.name === name);
            if (!timer) return;

            const modal = document.getElementById('timer-sheet-modal');
            const contentBox = document.getElementById('timer-detail-content');
            if (!modal || !contentBox) return;

            let html = `
            <div class="text-center mb-6">
                <h3 class="text-xl font-bold text-gray-900 mb-1">${timer.name}</h3>
                <p class="text-sm text-gray-500">${timer.desc}</p>
            </div>
            `;

            if (timer.type === 'reset') {
                const statusData = (typeof getChecklistStatus === 'function') ? getChecklistStatus() : { checked: {} };
                const sourceData = (typeof TASK_DATA !== 'undefined') ? TASK_DATA : LOCAL_TASK_DATA;
                const tasks = sourceData.filter(t => t.freq === timer.freq);

                if (tasks.length > 0) {
                    html += `<div class="grid grid-cols-1 gap-3 max-h-[60vh] overflow-y-auto no-scrollbar pb-10">`;
                    tasks.forEach(task => {
                        const isChecked = statusData.checked[task.id];
                        const bgClass = isChecked ? 'bg-blue-50 border-blue-100' : 'bg-gray-50 border-gray-100';
                        const textClass = isChecked ? 'text-gray-400 line-through' : 'text-gray-800';
                        const checkIcon = isChecked ? 'âœ”' : '';

                        html += `
                        <div id="sheet-task-${task.id}" class="flex items-center justify-between p-4 rounded-xl border ${bgClass} cursor-pointer active:scale-95 transition-all" onclick="toggleSheetTask('${task.id}')">
                            <div class="flex items-center gap-3 overflow-hidden">
                                <span class="text-[11px] px-1.5 py-0.5 bg-white border border-gray-200 rounded text-gray-500 whitespace-nowrap font-bold">${task.loc}</span>
                                <span class="text-[15px] font-medium ${textClass} truncate">${task.title}</span>
                            </div>
                            <div class="task-check-icon w-6 h-6 rounded-full border border-gray-300 bg-white flex items-center justify-center text-sm text-blue-600 font-bold flex-none shadow-sm">${checkIcon}</div>
                        </div>`;
                    });
                    html += `</div>`;
                } else {
                    html += `<p class="text-center text-gray-400 py-10">ì²´í¬ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
                }
            } else {
                html += `<div class="bg-gray-50 p-5 rounded-xl border border-gray-100 text-gray-600 leading-relaxed text-sm">${timer.desc}<br>ì‹œê°„ì— ë§ì¶° ì°¸ì—¬í•´ë³´ì„¸ìš”!</div>`;
            }

            contentBox.innerHTML = html;
            modal.classList.remove('hidden'); 
            modal.classList.add('show');      
        };

        window.toggleSheetTask = function (taskId) {
            toggleTaskCheck(taskId); 
            const el = document.getElementById(`sheet-task-${taskId}`);
            if (el) {
                const statusData = (typeof getChecklistStatus === 'function') ? getChecklistStatus() : { checked: {} };
                const isChecked = statusData.checked[taskId];
                const icon = el.querySelector('.task-check-icon');
                const title = el.querySelector('span.truncate');

                if (isChecked) {
                    el.className = "flex items-center justify-between p-4 rounded-xl border bg-blue-50 border-blue-100 cursor-pointer active:scale-95 transition-all";
                    if (title) title.className = "text-[15px] font-medium text-gray-400 line-through truncate";
                    if (icon) icon.innerText = 'âœ”';
                } else {
                    el.className = "flex items-center justify-between p-4 rounded-xl border bg-gray-50 border-gray-100 cursor-pointer active:scale-95 transition-all";
                    if (title) title.className = "text-[15px] font-medium text-gray-800 truncate";
                    if (icon) icon.innerText = '';
                }
            }
        };

        window.closeTimerSheet = function () {
            const modal = document.getElementById('timer-sheet-modal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('show');
            }
        };

        window.updateTimers = function () {
            if (typeof TIMERS === 'undefined') return;
            const now = new Date();
            const serverTimeEl = document.getElementById('server-time');
            if (serverTimeEl) serverTimeEl.innerText = now.toTimeString().split(' ')[0];

            const statusData = (typeof getChecklistStatus === 'function') ? getChecklistStatus() : { checked: {} };
            const sourceData = (typeof TASK_DATA !== 'undefined') ? TASK_DATA : LOCAL_TASK_DATA;

            const todoList = document.getElementById('gangho-timer-list-tab');
            if (todoList && document.getElementById('view-todo').style.display !== 'none') {
                let todoHtml = '';
                const groups = [
                    { title: 'ğŸ“… ì¼ì¼ ì»¨í…ì¸ ', desc: 'ë§¤ì¼ 06:00 ì´ˆê¸°í™”', ids: ['daily', 'pvp_daily'] },
                    { title: 'ğŸ“… ì£¼ê°„ ì»¨í…ì¸ ', desc: 'ë§¤ì£¼ ì›”ìš”ì¼ 06:00 ì´ˆê¸°í™”', ids: ['weekly', 'fireworks_weekly'] },
                    { title: 'ğŸ“… ì›”ê°„ / ì´ë²¤íŠ¸', desc: 'ë§¤ì›” 1ì¼ 06:00 ì´ˆê¸°í™”', ids: ['monthly', 'event_winter'] }
                ];

                groups.forEach(group => {
                    let groupContent = '';
                    let groupTimeStr = '';
                    group.ids.forEach(timerId => {
                        const timer = TIMERS.find(t => t.id === timerId);
                        if (!timer) return;

                        if (timer.type === 'reset' && !groupTimeStr) {
                            const target = getNextResetTime(timer.freq, now);
                            const diff = target - now;
                            groupTimeStr = `<span class="text-blue-600 font-bold">${formatDuration(diff)}</span> ë‚¨ìŒ`;
                        }

                        if (timer.type === 'reset') {
                            const tasks = sourceData.filter(t => t.freq === timer.freq);
                            if (tasks.length > 0) {
                                groupContent += `<div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-3">`;
                                tasks.forEach(task => {
                                    const isChecked = statusData.checked[task.id];
                                    const bgClass = isChecked ? 'bg-blue-50 border-blue-100' : 'bg-gray-50 border-gray-100';
                                    const textClass = isChecked ? 'text-gray-400 line-through' : 'text-gray-800';
                                    const checkIcon = isChecked ? 'âœ”' : '';
                                    groupContent += `
                                    <div class="flex items-center justify-between p-3 rounded-xl border ${bgClass} cursor-pointer active:scale-95 transition-all" onclick="toggleTaskCheck('${task.id}', this)">
                                        <div class="flex items-center gap-2 overflow-hidden">
                                            <span class="text-[10px] px-1.5 py-0.5 bg-white border border-gray-200 rounded text-gray-500 whitespace-nowrap">${task.loc}</span>
                                            <span class="text-sm font-medium ${textClass} truncate">${task.title}</span>
                                        </div>
                                        <div class="w-5 h-5 rounded-full border border-gray-300 bg-white flex items-center justify-center text-xs text-blue-600 font-bold flex-none">${checkIcon}</div>
                                    </div>`;
                                });
                                groupContent += `</div>`;
                            }
                        } else {
                            let statusText = "í™•ì¸";
                            let statusClass = "bg-gray-100 text-gray-500";
                            if (timer.type === 'daily_operating') {
                                statusText = (now.getHours() >= 5 && now.getHours() < 7) ? "íœ´ì¥" : "ìš´ì˜";
                                statusClass = statusText === 'ìš´ì˜' ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-500';
                            } else if (timer.type === 'schedule') {
                                const res = calculateSchedule(timer.schedules, now);
                                statusText = res.statusText + " (" + res.timeStr + ")";
                                statusClass = res.isRunning ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-500';
                            } else if (timer.type === 'event') {
                                statusText = "ì§„í–‰ ì¤‘"; statusClass = 'bg-purple-50 text-purple-600';
                            }
                            groupContent += `
                            <div class="mt-3 p-3 bg-white border border-gray-100 rounded-xl flex justify-between items-center shadow-sm">
                                <span class="text-sm font-bold text-gray-700">ğŸš© ${timer.name}</span>
                                <span class="text-xs font-bold px-2 py-1 rounded ${statusClass}">${statusText}</span>
                            </div>`;
                        }
                    });
                    todoHtml += `
                    <div class="bg-white p-5 rounded-2xl border border-gray-200 shadow-sm">
                        <div class="flex justify-between items-end pb-3 border-b border-gray-100 mb-2">
                            <div><h3 class="text-lg font-extrabold text-gray-900 leading-none">${group.title}</h3><p class="text-xs text-gray-400 mt-1">${group.desc}</p></div>
                            <div class="text-xs text-right">${groupTimeStr}</div>
                        </div>
                        ${groupContent}
                    </div>`;
                });
                todoList.innerHTML = todoHtml;
            }
        };

        window.openGuideDirect = function (url) { if (typeof loadGuideContent === 'function') { loadGuideContent(url); switchTab('guide'); } else { switchTab('guide'); } };
        window.openReportSheet = function () { const sheet = document.getElementById('report-sheet-modal'); sheet.classList.remove('hidden'); setTimeout(() => sheet.children[1].classList.remove('translate-y-full'), 10); };
        window.closeReportSheet = function () { const sheet = document.getElementById('report-sheet-modal'); sheet.children[1].classList.add('translate-y-full'); setTimeout(() => sheet.classList.add('hidden'), 300); };

        setInterval(updateTimers, 1000);
        window.addEventListener('DOMContentLoaded', () => {
            updateTimers();
        });
    </script>
</body>
</html>