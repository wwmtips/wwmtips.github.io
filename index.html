<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì—°ìš´: í•œêµ­ ìœ„í‚¤</title>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5SMVDZTDST"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-5SMVDZTDST');
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#3182f6', bgMain: '#f2f4f6' }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f2f4f6; color: #191f28; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .snap-x-mandatory { scroll-snap-type: x mandatory; }
        .snap-start { scroll-snap-align: start; }
        
        /* [ì¤‘ìš”] timer.js í˜¸í™˜ì„±ì„ ìœ„í•œ ìœ í‹¸ë¦¬í‹° */
        .show { display: block !important; } /* ë°”í…€ì‹œíŠ¸ ê°•ì œ í‘œì‹œ */
        
        /* ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™” ìŠ¤íƒ€ì¼ */
        .nav-item.active { @apply text-gray-900; }
        .nav-item.active svg { @apply stroke-gray-900 stroke-2; }
    </style>
</head>

<body class="pb-24">

    <script src="hw.js"></script>
    <script src="script.js"></script>
    <script src="timer.js"></script>

    <div id="sidebar-overlay" onclick="closeSidebar()" class="fixed inset-0 bg-black/40 z-[2999] hidden backdrop-blur-sm transition-opacity"></div>

    <header class="sticky top-0 z-50 bg-white h-[60px] flex items-center px-5 gap-3 border-b border-gray-100">
        <div class="flex-1 bg-gray-100 rounded-lg h-10 flex items-center px-3 text-gray-500">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            <input type="text" id="header-search-input" placeholder="ê²€ìƒ‰" class="bg-transparent border-none w-full h-full ml-2 outline-none text-gray-800 text-sm" autocomplete="off">
        </div>

        <button onclick="toggleSidebar()" class="w-10 h-10 flex items-center justify-center text-gray-800 cursor-pointer hover:bg-gray-50 rounded-full transition-colors">
            <svg class="w-7 h-7" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </button>
        
        <div id="global-search-results" class="hidden absolute top-[60px] left-0 right-0 bg-white z-50 border-t shadow-lg max-h-[300px] overflow-y-auto"></div>
    </header>

    <aside id="main-sidebar" class="fixed top-0 right-[-100%] w-full max-w-[320px] h-full bg-white z-[3000] flex flex-col transition-[right] duration-300 ease-in-out shadow-2xl">
        <div class="flex justify-between items-center px-5 h-[60px] border-b border-gray-100">
            <div class="text-lg font-bold text-gray-800">ì „ì²´ ë©”ë‰´</div>
            <div class="flex gap-4 text-gray-800">
                 <button>ğŸ””</button>
                 <button>âš™ï¸</button>
                 <button onclick="closeSidebar()">âœ•</button>
            </div>
        </div>
        <div class="flex-1 overflow-y-auto p-5">
            <div class="mb-8">
                <div class="text-xs font-bold text-gray-400 mb-3">ë°”ë¡œê°€ê¸°</div>
                <div class="space-y-4">
                    <div class="flex items-center gap-3 text-[16px] font-bold text-gray-800 cursor-pointer" onclick="switchTab('home'); closeSidebar();"><span class="text-xl w-6 text-center">ğŸ </span> í™ˆ</div>
                    <div class="flex items-center gap-3 text-[16px] font-bold text-gray-800 cursor-pointer" onclick="switchTab('todo'); closeSidebar();"><span class="text-xl w-6 text-center">â°</span> ì˜¤ëŠ˜ì˜ í•  ì¼</div>
                    <div class="flex items-center gap-3 text-[16px] font-bold text-gray-800 cursor-pointer" onclick="switchTab('quest'); closeSidebar();"><span class="text-xl w-6 text-center">ğŸ“œ</span> ë¬´ë¦¼ë¡</div>
                    <div class="flex items-center gap-3 text-[16px] font-bold text-gray-800 cursor-pointer" onclick="switchTab('chunji'); closeSidebar();"><span class="text-xl w-6 text-center">ğŸº</span> ì²œì§€ë¡</div>
                </div>
            </div>
            
            <div class="mb-8">
                <div class="text-xs font-bold text-gray-400 mb-3">ì»¤ë®¤ë‹ˆí‹°</div>
                <div class="space-y-4">
                    <div class="flex items-center gap-3 text-[16px] font-bold text-gray-800 cursor-pointer" onclick="switchTab('quiz'); closeSidebar();"><span class="text-xl w-6 text-center">â“</span> ìŠ¤ë¬´ê³ ê°œ ì¡±ë³´</div>
                    <div class="flex items-center gap-3 text-[16px] font-bold text-gray-800 cursor-pointer" onclick="openGuideDirect('code.html'); closeSidebar();"><span class="text-xl w-6 text-center">ğŸ«</span> êµí™˜ ì½”ë“œ</div>
                    <div class="flex items-center gap-3 text-[16px] font-bold text-gray-800 cursor-pointer" onclick="openReportSheet(); closeSidebar();"><span class="text-xl w-6 text-center">ğŸ“¢</span> ì œë³´í•˜ê¸°</div>
                </div>
            </div>
        </div>
    </aside>

    <main id="main-content">
        <div id="view-home">
            <section class="relative aspect-[21/10] bg-gray-200 mb-3 overflow-hidden">
                <div class="w-full h-full relative">
                    <div id="hero-slider-track" class="flex h-full transition-transform duration-500 ease-in-out"></div> 
                    <div id="slider-indicators" class="absolute bottom-4 w-full flex justify-center gap-1.5 z-10"></div>
                </div>
            </section>

            <section class="bg-white p-5 mb-3">
                <div class="flex justify-between items-end mb-4">
                    <h3 class="text-[19px] font-extrabold text-gray-900">ê¸°ë³¸ ê°€ì´ë“œ</h3>
                </div>
                <div class="relative">
                    <div id="guide-scroll-wrapper" class="flex overflow-x-auto gap-3 pb-4 snap-x-mandatory no-scrollbar lg:grid lg:grid-cols-6 lg:gap-4 lg:pb-0">
                        <a onclick="openGuideDirect('newb.html')" class="flex-none w-[23%] snap-start flex flex-col items-center gap-2 cursor-pointer active:scale-95 transition lg:w-auto">
                            <div class="w-12 h-12 bg-orange-50 rounded-2xl flex items-center justify-center text-2xl border border-orange-100/50">ğŸ“œ</div>
                            <span class="text-xs font-bold text-gray-600 text-center leading-tight whitespace-nowrap">ê°•í˜¸<br>ì…ë¬¸ì„œ</span>
                        </a>
                        <a onclick="openGuideDirect('guide/up.html')" class="flex-none w-[23%] snap-start flex flex-col items-center gap-2 cursor-pointer active:scale-95 transition lg:w-auto">
                            <div class="w-12 h-12 bg-red-50 rounded-2xl flex items-center justify-center text-2xl border border-red-100/50">ğŸ“ˆ</div>
                            <span class="text-xs font-bold text-gray-600 text-center leading-tight whitespace-nowrap">ìœ¡ì„±<br>ê°€ì´ë“œ</span>
                        </a>
                        <a onclick="openGuideDirect('moon.html')" class="flex-none w-[23%] snap-start flex flex-col items-center gap-2 cursor-pointer active:scale-95 transition lg:w-auto">
                            <div class="w-12 h-12 bg-gray-100 rounded-2xl flex items-center justify-center text-2xl border border-gray-200/50">ğŸ›ï¸</div>
                            <span class="text-xs font-bold text-gray-600 text-center leading-tight whitespace-nowrap">ë¬¸íŒŒ<br>ì…ë¬¸</span>
                        </a>
                        <a onclick="openGuideDirect('guide/weapon.html')" class="flex-none w-[23%] snap-start flex flex-col items-center gap-2 cursor-pointer active:scale-95 transition lg:w-auto">
                            <div class="w-12 h-12 bg-blue-50 rounded-2xl flex items-center justify-center text-2xl border border-blue-100/50">âš”ï¸</div>
                            <span class="text-xs font-bold text-gray-600 text-center leading-tight whitespace-nowrap">ì¥ë¹„<br>ë„ê°</span>
                        </a>
                        <a onclick="openGuideDirect('tier_weapon.html')" class="flex-none w-[23%] snap-start flex flex-col items-center gap-2 cursor-pointer active:scale-95 transition lg:w-auto">
                            <div class="w-12 h-12 bg-purple-50 rounded-2xl flex items-center justify-center text-2xl border border-purple-100/50">ğŸŒ€</div>
                            <span class="text-xs font-bold text-gray-600 text-center leading-tight whitespace-nowrap">ë¬´ê³µ<br>ë„ê°</span>
                        </a>
                        <a onclick="openGuideDirect('majang.html')" class="flex-none w-[23%] snap-start flex flex-col items-center gap-2 cursor-pointer active:scale-95 transition lg:w-auto">
                            <div class="w-12 h-12 bg-pink-50 rounded-2xl flex items-center justify-center text-2xl border border-pink-100/50">ğŸ€„</div>
                            <span class="text-xs font-bold text-gray-600 text-center leading-tight whitespace-nowrap">ë§ˆì‘<br>ê°€ì´ë“œ</span>
                        </a>
                    </div>
                    <div class="flex justify-center gap-1.5 mt-2 lg:hidden" id="guide-indicators">
                        <div class="w-1.5 h-1.5 rounded-full bg-blue-500 transition-all duration-300"></div>
                        <div class="w-1.5 h-1.5 rounded-full bg-gray-200 transition-all duration-300"></div>
                    </div>
                </div>
            </section>

            <section class="bg-white p-5 mb-3">
                <div class="flex justify-between items-end mb-4">
                    <h3 class="text-[19px] font-extrabold text-gray-900">ì˜¤ëŠ˜ì˜ í•  ì¼</h3>
                    <span class="text-sm font-bold text-gray-400 cursor-pointer hover:text-gray-600" onclick="switchTab('todo')">ë”ë³´ê¸°</span>
                </div>
                <div id="gangho-timer-list" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div class="text-center py-10 text-gray-400 text-sm">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </section>

            <section class="bg-white p-5 mb-3">
                <div class="flex justify-between items-end mb-4">
                    <h3 class="text-[19px] font-extrabold text-gray-900">ë¬´ë¦¼ë¡</h3>
                    <span class="text-sm font-bold text-gray-400 cursor-pointer hover:text-gray-600" onclick="switchTab('quest')">ì „ì²´ë³´ê¸°</span>
                </div>
                <div id="mansarok-list" class="flex flex-col divide-y divide-gray-100"></div>
            </section>
            
            <section class="bg-white p-5 mb-3">
                <div class="flex justify-between items-end mb-4">
                    <h3 class="text-[19px] font-extrabold text-gray-900">ì²œì§€ë¡</h3>
                    <span class="text-sm font-bold text-gray-400 cursor-pointer hover:text-gray-600" onclick="switchTab('chunji')">ì „ì²´ë³´ê¸°</span>
                </div>
                <div id="home-chunji-list" class="flex flex-col divide-y divide-gray-100"></div>
            </section>
        </div>

        <div id="view-todo" style="display: none;" class="p-5">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-900">ê°•í˜¸ ì‹œì‹œê°ê°</h2>
                <span id="server-time" class="text-xs font-mono bg-white border border-gray-200 px-2 py-1 rounded text-gray-500">00:00:00</span>
            </div>
            <div id="gangho-timer-list-tab" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
        </div>

        <div id="view-quest" style="display: none;" class="p-5">
            <div id="quest-list-view">
                <div class="flex gap-2 mb-4 overflow-x-auto no-scrollbar">
                    <select id="quest-type-select" class="bg-white border border-gray-200 text-sm p-2 rounded-lg outline-none focus:border-blue-500" onchange="onQuestTypeChange()"><option value="all">ì „ì²´</option></select>
                    <select id="quest-location-select" class="bg-white border border-gray-200 text-sm p-2 rounded-lg outline-none focus:border-blue-500" onchange="applyQuestFilter()"><option value="all">ì§€ì—­</option></select>
                </div>
                <div id="quest-grid-container" class="space-y-3"></div>
                <div id="pagination-container" class="flex justify-center gap-2 mt-8 pb-10"></div>
            </div>
            <div id="quest-detail-view" style="display:none;">
                <button onclick="showQuestList()" class="mb-4 text-sm font-bold text-blue-600 flex items-center"><span class="text-lg mr-1">â†</span> ëª©ë¡ìœ¼ë¡œ</button>
                <div id="quest-content-loader" class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm min-h-[200px]"></div>
            </div>
        </div>

        <div id="view-chunji" style="display: none;" class="p-5">
            <div id="chunji-list-view">
                <div class="flex gap-2 mb-4">
                    <select id="chunji-type-select" class="bg-white border border-gray-200 text-sm p-2 rounded-lg outline-none" onchange="onChunjiTypeChange()"><option value="all">ì „ì²´</option></select>
                </div>
                <div id="chunji-list-container" class="grid grid-cols-1 gap-0 bg-white rounded-xl border border-gray-100 divide-y divide-gray-100"></div>
                <div id="chunji-pagination-container" class="flex justify-center gap-2 mt-8 pb-10"></div>
            </div>
            <div id="chunji-detail-view" style="display:none;">
                <button onclick="showChunjiList()" class="mb-4 text-sm font-bold text-blue-600 flex items-center"><span class="text-lg mr-1">â†</span> ëª©ë¡ìœ¼ë¡œ</button>
                <div id="chunji-detail-content" class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm min-h-[200px]"></div>
            </div>
        </div>

        <div id="view-quiz" style="display: none;" class="p-5">
            <div id="quiz-counter-area" class="text-xs text-gray-500 mb-2 font-medium">ë°ì´í„° ë¡œë”© ì¤‘...</div>
            <input type="text" id="quiz-local-search" class="w-full bg-white border border-gray-200 p-3 rounded-xl mb-4 text-sm outline-none focus:border-blue-500 transition-colors" placeholder="ë‹¨ì„œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê°€ì‹œ)">
            <div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm">
                <table class="w-full text-sm text-left"><tbody id="quiz-table-body"></tbody></table>
            </div>
        </div>

        <div id="view-guide" style="display: none;" class="p-5"><div id="guide-content-loader"></div><div id="guide-dynamic-content" class="bg-white rounded-xl p-5 border border-gray-100"></div></div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 h-[60px] flex justify-between items-center px-6 z-50">
        <button id="nav-home" onclick="switchTab('home')" class="nav-item active flex flex-col items-center justify-center w-14 gap-1 text-gray-400">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
            <span class="text-[10px] font-bold">í™ˆ</span>
        </button>
        <button id="nav-quest" onclick="switchTab('quest')" class="nav-item flex flex-col items-center justify-center w-14 gap-1 text-gray-400">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
            <span class="text-[10px] font-bold">ë¬´ë¦¼ë¡</span>
        </button>
        <button id="nav-todo" onclick="switchTab('todo')" class="nav-item flex flex-col items-center justify-center w-14 gap-1 text-gray-400">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
            <span class="text-[10px] font-bold">í•  ì¼</span>
        </button>
        <button id="nav-quiz" onclick="switchTab('quiz')" class="nav-item flex flex-col items-center justify-center w-14 gap-1 text-gray-400">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <span class="text-[10px] font-bold">ìŠ¤ë¬´ê³ ê°œ</span>
        </button>
    </nav>

    <div id="timer-sheet-modal" class="fixed inset-0 z-[9999] hidden backdrop-blur-sm transition-opacity">
        <div class="absolute inset-0 bg-black/50" onclick="closeTimerSheet()"></div>
        <div class="absolute bottom-0 w-full bg-white rounded-t-2xl p-6 shadow-2xl transition-transform duration-300">
            <div id="timer-detail-content"></div>
        </div>
    </div>
    
    <div id="report-sheet-modal" class="fixed inset-0 z-[9999] hidden">
        <div class="absolute inset-0 bg-black/50 transition-opacity" onclick="closeReportSheet()"></div>
        <div class="absolute bottom-0 w-full bg-white rounded-t-2xl p-6 transition-transform transform translate-y-full duration-300 ease-out">
            <div class="w-10 h-1 bg-gray-300 rounded-full mx-auto mb-6"></div>
            <div class="bg-gray-50 p-4 rounded-xl mb-4 text-sm text-gray-600">ì˜¤ë¥˜ ì œë³´ëŠ” ì–¸ì œë‚˜ í™˜ì˜í•©ë‹ˆë‹¤.</div>
            <button onclick="window.open('https://open.kakao.com/o/sXW3q9bg', '_blank')" class="w-full py-4 bg-yellow-300 rounded-xl font-bold text-gray-900">ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì œë³´í•˜ê¸°</button>
        </div>
    </div>

    <script>
        // ì‚¬ì´ë“œë°”
        function toggleSidebar() { 
            const sb = document.getElementById('main-sidebar');
            const ol = document.getElementById('sidebar-overlay');
            if(sb && ol) { sb.style.right = '0'; ol.classList.remove('hidden'); document.body.style.overflow = 'hidden'; }
        }
        function closeSidebar() { 
            const sb = document.getElementById('main-sidebar');
            const ol = document.getElementById('sidebar-overlay');
            if(sb && ol) { sb.style.right = '-100%'; ol.classList.add('hidden'); document.body.style.overflow = ''; }
        }

        // ê°€ì´ë“œ ìŠ¤í¬ë¡¤ ì¸ë””ì¼€ì´í„°
        const guideScroll = document.getElementById('guide-scroll-wrapper');
        const guideDots = document.getElementById('guide-indicators')?.children;
        if(guideScroll && guideDots) {
            guideScroll.addEventListener('scroll', () => {
                const percent = guideScroll.scrollLeft / (guideScroll.scrollWidth - guideScroll.clientWidth);
                if(percent > 0.5) {
                    guideDots[0].classList.replace('bg-blue-500', 'bg-gray-200');
                    guideDots[1].classList.replace('bg-gray-200', 'bg-blue-500');
                } else {
                    guideDots[1].classList.replace('bg-blue-500', 'bg-gray-200');
                    guideDots[0].classList.replace('bg-gray-200', 'bg-blue-500');
                }
            });
        }

        // íƒ­ ì „í™˜
        window.switchTab = function(tabName) {
            const views = ['view-home', 'view-quest', 'view-chunji', 'view-quiz', 'view-todo', 'view-guide'];
            views.forEach(v => { document.getElementById(v).style.display = (v === 'view-' + tabName) ? 'block' : 'none'; });
            
            const navIds = ['nav-home', 'nav-quest', 'nav-todo', 'nav-quiz'];
            navIds.forEach(id => {
                const el = document.getElementById(id);
                if (id === 'nav-' + tabName) { el.classList.add('active'); el.classList.remove('text-gray-400'); }
                else { el.classList.remove('active'); el.classList.add('text-gray-400'); }
            });
            window.scrollTo(0, 0);
        };

        // ê°€ì´ë“œ ë°”ë¡œê°€ê¸°
        function openGuideDirect(url) {
            if (typeof loadGuideContent === 'function') { loadGuideContent(url); switchTab('guide'); } 
            else { switchTab('guide'); }
        }

        // íƒ€ì´ë¨¸ ì‹œíŠ¸ ë‹«ê¸° & í˜¸í™˜ì„±
        function closeTimerSheet() { 
            const modal = document.getElementById('timer-sheet-modal');
            modal.classList.add('hidden'); 
            modal.classList.remove('show');
        }

        // í•  ì¼ ë¦¬ìŠ¤íŠ¸ (ì•ˆì „ì¥ì¹˜ + Tailwind ìŠ¤íƒ€ì¼)
        window.updateTimers = function() {
            const homeList = document.getElementById('gangho-timer-list');
            const tabList = document.getElementById('gangho-timer-list-tab');
            
            const timerData = (typeof TIMERS !== 'undefined') ? TIMERS : [
                { name: 'ì¼ì¼ ì´ˆê¸°í™”', desc: 'ë§¤ì¼ 05:00', type: 'reset', freq: 'daily' },
                { name: 'ì£¼ê°„ ì´ˆê¸°í™”', desc: 'ë§¤ì£¼ ì›” 05:00', type: 'reset', freq: 'weekly' }
            ];

            const now = new Date();
            const serverTimeEl = document.getElementById('server-time');
            if (serverTimeEl) serverTimeEl.innerText = now.toTimeString().split(' ')[0];

            let html = '';
            timerData.forEach(timer => {
                let timeText = "í™•ì¸";
                let isUrgent = false;
                
                if (typeof getNextResetTime === 'function' && typeof formatDuration === 'function' && timer.type === 'reset') {
                    const target = getNextResetTime(timer.freq, now);
                    const diff = target - now;
                    timeText = formatDuration(diff);
                    if (diff < 3 * 60 * 60 * 1000) isUrgent = true;
                } else if (timer.type === 'daily_operating') {
                    const h = now.getHours();
                    timeText = (h >= 5 && h < 7) ? "íœ´ì¥" : "ìš´ì˜";
                }

                const clockClass = isUrgent ? "text-red-500 bg-red-50" : "text-blue-500 bg-blue-50";
                html += `
                <div class="bg-white p-4 rounded-xl border border-gray-100 flex justify-between items-center cursor-pointer active:scale-95 transition-transform shadow-sm" onclick="openTimerSheetByName('${timer.name}')">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-orange-50 flex items-center justify-center text-xl text-orange-500">â°</div>
                        <div>
                            <div class="font-bold text-gray-800 text-[15px]">${timer.name}</div>
                            <div class="text-xs text-gray-500 mt-0.5">${timer.desc}</div>
                        </div>
                    </div>
                    <div class="text-xs font-bold px-2 py-1 rounded-md ${clockClass}">${timeText}</div>
                </div>`;
            });

            if (homeList) homeList.innerHTML = html;
            if (tabList) tabList.innerHTML = html;
        };

        // íƒ€ì´ë¨¸ ì‹œíŠ¸ ì—´ê¸° í—¬í¼ (timer.js ì—°ë™)
        // timer.jsê°€ ìˆìœ¼ë©´ openTimerSheetë¥¼ í˜¸ì¶œí•˜ê³ , ëª¨ë‹¬ì˜ hiddenì„ ì œê±°í•˜ì—¬ ë³´ì—¬ì¤ë‹ˆë‹¤.
        window.openTimerSheetByName = function(name) {
            if (typeof TIMERS !== 'undefined') {
                const t = TIMERS.find(x => x.name === name);
                if (t && typeof openTimerSheet === 'function') {
                    openTimerSheet(t);
                    // Tailwind 'hidden' í´ë˜ìŠ¤ ì œê±°í•˜ì—¬ í‘œì‹œ ë³´ì¥
                    document.getElementById('timer-sheet-modal').classList.remove('hidden');
                }
            }
        };
        
        // ì œë³´ ì‹œíŠ¸ ì œì–´
        function openReportSheet() { 
            const sheet = document.getElementById('report-sheet-modal');
            sheet.classList.remove('hidden'); 
            setTimeout(() => sheet.children[1].classList.remove('translate-y-full'), 10);
        }
        function closeReportSheet() {
            const sheet = document.getElementById('report-sheet-modal');
            sheet.children[1].classList.add('translate-y-full');
            setTimeout(() => sheet.classList.add('hidden'), 300);
        }

        // ë¬´ë¦¼ë¡ ë¡œë”
        function loadMansarokMenu() {
            fetch('json/quests.json').then(r=>r.json()).then(data => {
                const list = document.getElementById('mansarok-list');
                if(!list) return;
                list.innerHTML = '';
                data.filter(i=>!['ì§€ê³¼','ë³´ìŠ¤ ê³µëµ'].includes(i.type)).slice(0,10).forEach(item => {
                    const loc = item.location ? `<span class="bg-gray-100 text-gray-500 text-[11px] px-1.5 py-0.5 rounded font-medium mr-2">[${item.location}]</span>` : '';
                    list.innerHTML += `<div class="flex items-center justify-between py-3 px-1 cursor-pointer border-b border-gray-50 last:border-none active:bg-gray-50" onclick="switchTab('quest'); loadQuestDetail('${item.filepath}','${item.id}')">
                        <div class="flex items-center overflow-hidden">${loc}<span class="text-[15px] font-semibold text-gray-800 truncate">${item.name}</span></div>
                        <span class="text-gray-300 text-lg">â€º</span>
                    </div>`;
                });
            }).catch(e=>console.log(e));
        }
        
        function renderHomeChunjiOverride() {
            if (typeof chunjiData === 'undefined') return;
            const list = document.getElementById('home-chunji-list');
            if(!list) return;
            list.innerHTML = '';
            chunjiData.slice(0, 6).forEach(item => {
                list.innerHTML += `<div class="flex items-center justify-between py-3 px-1 cursor-pointer border-b border-gray-50 last:border-none active:bg-gray-50" onclick="switchTab('chunji'); loadChunjiDetail(item)">
                    <span class="text-[15px] font-semibold text-gray-800 truncate">${item.title}</span>
                    <span class="text-gray-300 text-lg">â€º</span>
                </div>`;
            });
        }
        window.renderHomeChunji = renderHomeChunjiOverride;

        // ì´ˆê¸°í™”
        setInterval(updateTimers, 1000);
        window.addEventListener('DOMContentLoaded', () => {
            updateTimers(); 
            loadMansarokMenu();
            setTimeout(() => { if(typeof renderHomeChunjiOverride === 'function') renderHomeChunjiOverride(); }, 500);
        });
    </script>
</body>
</html>