<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì—°ìš´: í•œêµ­ ìœ„í‚¤</title>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5SMVDZTDST"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-5SMVDZTDST');
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        /* [ê¸°ë³¸ ì„¤ì •] */
        :root {
            --bg-main: #f2f4f6;       
            --bg-card: #ffffff;       
            --text-main: #191f28;     
            --text-sub: #8b95a1;      
            --border-color: #f2f4f6;  
            --input-bg: #fff;         
            --primary: #3182f6;       
        }

        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--bg-main); color: var(--text-main); -webkit-tap-highlight-color: transparent; padding-bottom: 80px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* [í—¤ë”] */
        .app-header { background: var(--bg-main); padding: 0 20px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 50; height: 60px; }
        #header-main-mode { width: 100%; display: flex; align-items: center; gap: 12px; }
        
        .header-search-box { flex: 1; background: var(--input-bg); border-radius: 8px; height: 40px; display: flex; align-items: center; padding: 0 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.02); }
        .header-search-input { background: transparent; border: none; width: 100%; height: 100%; font-size: 14px; outline: none; color: var(--text-main); margin-left: 8px; }
        .header-menu-btn { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; color: #333; cursor: pointer; flex-shrink: 0; }

        #header-detail-mode { width: 100%; display: none; align-items: center; gap: 10px; }
        .header-back-btn { display: flex; align-items: center; gap: 6px; font-size: 16px; font-weight: 700; color: var(--text-main); cursor: pointer; padding: 10px 0; }

        /* [ê²€ìƒ‰ ê²°ê³¼ì°½] */
        #global-search-results { display: none; position: absolute; top: 60px; left: 0; right: 0; background: var(--bg-card); border-radius: 0 0 20px 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); z-index: 60; border-top: 1px solid var(--border-color); max-height:300px; overflow-y:auto; padding: 10px 0; }
        .search-result-item { padding: 12px 20px; border-bottom: 1px solid var(--border-color); cursor: pointer; display: flex; align-items: center; gap: 10px; color: var(--text-main); }
        .badge { padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; color: white; }
        .badge.quiz { background: #f59e0b; } .badge.item { background: #3b82f6; } .badge.info { background: #10b981; }

        /* [ì²­í¬(Chunk)] */
        .toss-section { background: var(--bg-card); border-radius: 0; padding: 24px 20px; margin: 0; border-bottom: 8px solid var(--bg-main); }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .section-title { font-size: 19px; font-weight: 800; color: var(--text-main); }
        
        .section-footer-btn {
            display: block; width: 100%; text-align: center; padding: 12px 0; margin-top: 8px;
            color: var(--primary); font-size: 13px; font-weight: 600; background: rgba(49, 130, 246, 0.08); border-radius: 8px; cursor: pointer; transition: background 0.2s;
        }
        .section-footer-btn:active { background: rgba(49, 130, 246, 0.15); }

        /* [ê°€ë¡œ ìŠ¤ì™€ì´í”„ ì»¨í…Œì´ë„ˆ] */
        .h-scroll-wrapper { display: flex; overflow-x: auto; gap: 12px; padding-bottom: 4px; scroll-snap-type: x mandatory; }
        .h-scroll-item {
            flex: 0 0 32%; min-width: 110px; scroll-snap-align: start; display: flex; flex-direction: column;
            background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; cursor: pointer;
        }
        .h-scroll-item:active { transform: scale(0.98); }

        .h-item-icon { font-size: 24px; margin-bottom: 8px; }
        .h-item-title { font-size: 13px; font-weight: 700; color: var(--text-main); margin-bottom: 2px; line-height: 1.3; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        .h-item-sub { font-size: 11px; color: var(--text-sub); }
        
        .timer-h-card { border-left: 3px solid var(--primary); }
        .timer-h-card.urgent { border-left-color: #e53935; }

        /* [ìŠ¬ë¼ì´ë”] */
        .hero-section { margin: 0; border-radius: 0; overflow: hidden; border-bottom: 8px solid var(--bg-main); }
        .hero-slider-wrapper { position: relative; width: 100%; aspect-ratio: 21/10; background: var(--border-color); border-radius: 0; }
        .slider-track { display: flex; height: 100%; transition: transform 0.5s ease-in-out; }
        .hero-slide { flex: none; width: 100%; height: 100%; background-size: cover; background-position: center; position: relative !important; cursor: pointer; }
        .slide-content { position: absolute; bottom: 0; left: 0; right: 0; padding: 16px; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; z-index: 10; }
        .slide-title { font-size: 17px; font-weight: bold; margin-bottom: 4px; }
        .slide-tag { font-size: 10px; background: var(--primary); padding: 2px 6px; border-radius: 4px; margin-bottom: 4px; display: inline-block; }
        .indicator { width: 5px; height: 5px; border-radius: 50%; background: rgba(255,255,255,0.4); cursor: pointer; }
        .indicator.active { width: 15px; background: white; border-radius: 10px; }

        /* [ê°€ì´ë“œ ìŠ¤ì™€ì´í”„] */
        .guide-scroll-container { display: flex; overflow-x: auto; gap: 12px; padding-bottom: 10px; scroll-snap-type: x mandatory; }
        @media (min-width: 1024px) {
            .guide-scroll-container { display: grid; grid-template-columns: repeat(6, 1fr); overflow-x: visible; }
            .guide-indicators { display: none !important; }
        }
        .guide-icon-btn { flex: 0 0 22%; scroll-snap-align: start; display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .guide-icon-btn:active { transform: scale(0.96); }
        .guide-icon-box { width: 48px; height: 48px; border-radius: 18px; background: var(--bg-main); display: flex; align-items: center; justify-content: center; font-size: 22px; margin-bottom: 6px; }
        .guide-icon-text { font-size: 11px; color: var(--text-sub); font-weight: 600; text-align: center; line-height: 1.3; white-space: nowrap; }
        .guide-indicators { display: flex; justify-content: center; gap: 4px; margin-top: 5px; }
        .g-dot { width: 6px; height: 6px; border-radius: 50%; background: #e5e7eb; transition: all 0.3s; }
        .g-dot.active { background: var(--primary); width: 12px; border-radius: 4px; }

        /* [í•˜ë‹¨ íƒ­ë°”] */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--nav-bg); backdrop-filter: blur(10px); border-top: 1px solid var(--border-color); padding: 8px 20px 20px 20px; display: flex; justify-content: space-between; z-index: 100; }
        .nav-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; color: var(--text-sub); width: 60px; cursor: pointer; }
        .nav-btn svg { width: 24px; height: 24px; }
        .nav-btn span { font-size: 10px; font-weight: 500; }
        .nav-btn.active { color: var(--text-main); }
        .nav-btn.active span { font-weight: 700; }

        /* [ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ] - ë¬´ë¦¼ë¡/ì²œì§€ë¡ */
        .mansarok-btn, .chunji-item-card { 
            display: flex !important; align-items: center; justify-content: space-between !important; 
            padding: 12px 0 !important; border-bottom: 1px solid var(--border-color) !important; 
            background: transparent !important; box-shadow: none !important; border: none !important; border-radius: 0 !important;
            margin-bottom: 0 !important; width: 100% !important; height: auto !important; min-height: auto !important;
            flex-direction: row !important; gap: 10px !important;
        }
        .mansarok-btn:last-child, .chunji-item-card:last-child { border-bottom: none !important; }
        .mansarok-btn span, .chunji-card-title { font-size: 15px; font-weight: 600; color: var(--text-main); text-align: left; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .mansarok-btn::after, .chunji-item-card::after { content: 'â€º'; font-size: 18px; color: #d1d5db; font-weight: 400; margin-left: auto; }
        .list-loc-badge { font-size: 11px; color: var(--text-sub); padding: 0; margin-right: 2px; flex-shrink: 0; font-weight: 500; }

        /* [íƒ€ì´ë¨¸ ë¦¬ìŠ¤íŠ¸] */
        .timer-row { background-color: var(--bg-card); border-bottom: 1px solid var(--border-color); padding: 14px 0; margin-bottom: 0; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .timer-icon-box { width: 36px; height: 36px; background: #fff1f1; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 18px; margin-right: 12px; flex-shrink: 0; }
        .timer-info { display: flex; flex-direction: column; gap: 2px; flex: 1; }
        .timer-name { font-size: 15px; font-weight: 700; color: var(--text-main); display: flex; align-items: center; gap: 4px; }
        .timer-desc { font-size: 12px; color: var(--text-sub); }
        .timer-clock { font-family: 'Roboto Mono', monospace; font-size: 13px; font-weight: 600; color: var(--primary); } 
        .timer-clock.urgent { color: #e53935; }
        .timer-progress-text { font-size: 12px; font-weight: 700; color: var(--primary); margin-right: 2px; }

        /* [ë°”í…€ì‹œíŠ¸] */
        #timer-sheet-modal, #person-bottom-sheet { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9999; display: none; opacity: 0; transition: opacity 0.2s; backdrop-filter: blur(2px); }
        #timer-sheet-modal.show, #person-bottom-sheet.active { display: block; opacity: 1; }
        .sheet-container, .bottom-sheet-content { position: absolute; bottom: 0; width: 100%; background: var(--bg-card); border-top-left-radius: 20px; border-top-right-radius: 20px; padding: 24px 24px 40px 24px; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1); max-height: 85vh; overflow-y: auto; box-shadow: 0 -4px 20px rgba(0,0,0,0.15); }
        #timer-sheet-modal.show .sheet-container, #person-bottom-sheet.active .bottom-sheet-content { transform: translateY(0); }
        .sheet-handle, .sheet-handle-bar { width: 40px; height: 4px; background: var(--text-sub); border-radius: 2px; margin: 0 auto 24px auto; opacity: 0.3; }

        /* ìƒì„¸ í™”ë©´ */
        .chunji-detail-card { background-color: var(--bg-card); border-radius: 0; padding: 24px; box-shadow: none; border-bottom: 1px solid var(--bg-main); margin-bottom: 0; }
        .cd-header { margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; }
        .cd-title { font-size: 22px; font-weight: 800; color: var(--text-main); margin-bottom: 6px; }
        .cd-badge { display: inline-block; background: var(--bg-main); color: var(--text-sub); font-size: 11px; padding: 3px 8px; border-radius: 4px; font-weight: 600; }
        .cd-section { margin-bottom: 24px; }
        .cd-subtitle { font-size: 15px; font-weight: 700; color: var(--text-main); margin-bottom: 8px; display: flex; align-items: center; }
        .cd-subtitle::before { content: ''; display: inline-block; width: 4px; height: 14px; background: var(--primary); margin-right: 8px; border-radius: 2px; }
        .cd-text { font-size: 14px; color: var(--text-main); line-height: 1.6; background: var(--bg-main); padding: 12px; border-radius: 8px; white-space: pre-line; }
        .cd-img-container { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .cd-img { width: 100%; border-radius: 8px; border: 1px solid var(--border-color); object-fit: cover; }
        .nav-btn-row { display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color); }
        .nav-move-btn { display: flex; align-items: center; gap: 5px; font-size: 14px; font-weight: 600; color: var(--text-sub); padding: 8px 12px; border-radius: 8px; transition: background 0.2s; }
        .nav-move-btn:hover { background: var(--btn-bg-active); color: var(--primary); }
        
        /* ì¸ë¬¼ ë°”í…€ì‹œíŠ¸ */
        .person-sheet-header { text-align: center; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); }
        .person-img-container { display: inline-block; padding: 5px; background: var(--bg-card); border-radius: 16px; box-shadow: none; border: 1px solid var(--border-color); margin-bottom: 15px; }
        .person-img-large { width: 100px; height: 100px; border-radius: 12px; object-fit: cover; }
        .person-info-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px dashed var(--border-color); color: var(--text-main); }
        .person-bio-box { background: var(--bg-main); padding: 16px; border-radius: 12px; margin-top: 20px; color: var(--text-main); }
        .person-close-btn { width: 100%; padding: 14px; background: var(--text-main); color: var(--bg-card); border-radius: 12px; font-weight: 700; font-size: 15px; margin-top: 30px; cursor: pointer; }

        /* ì‚¬ì´ë“œë°” */
        #main-sidebar { position: fixed; top: 0; right: -300px; width: 280px; height: 100%; background: var(--bg-card); z-index: 3000; transition: right 0.3s ease; box-shadow: -10px 0 20px rgba(0,0,0,0.1); color: var(--text-main); }
        #main-sidebar.active { right: 0; }
        #sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); display: none; z-index: 2999; backdrop-filter: blur(2px); }
        #sidebar-overlay.active { display: block; }
    </style>
</head>

<body>
    <script>
        const EVENT_API_URL = "https://script.google.com/macros/s/AKfycbzSYkfFvOnpuL9MUWpHJk-wFa6_u8pAJW5OOVy0oYY8JK36E5n7oq7wxlMnU-vGKqBr/exec";
        const BUILD_API_URL = "https://script.google.com/macros/s/AKfycbz7c8YREyAa6aD1F3f7Hve3meAsOtjepSX_zyZLVbloj9qosdLgSArdBYFGKGYmNU2_tQ/exec";
    </script>

    <div id="sidebar-overlay" onclick="closeSidebar()"></div>

    <header id="main-header" class="app-header">
        <div id="header-main-mode">
            <div class="header-search-box">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--text-sub)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="text" id="header-search-input" placeholder="ê²€ìƒ‰" class="header-search-input" autocomplete="off">
            </div>

            <button onclick="toggleSidebar()" class="header-menu-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
            </button>
        </div>

        <div id="header-detail-mode">
            <div class="header-back-btn" id="header-back-action">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                <span>ëª©ë¡ìœ¼ë¡œ</span>
            </div>
        </div>
        
        <div id="global-search-results"></div>
    </header>

    <main id="main-content">
        
        <div id="view-home">
            
            <section class="hero-section">
                <div class="hero-slider-wrapper">
                    <div id="hero-slider-track" class="slider-track"></div>
                    <div id="slider-indicators" class="absolute bottom-4 left-0 right-0 flex justify-center gap-1.5"></div>
                </div>
            </section>

            <section class="toss-section">
                <div class="section-header">
                    <h3 class="section-title">ê¸°ë³¸ ê°€ì´ë“œ</h3>
                </div>
                <div class="guide-scroll-container no-scrollbar">
                    <a onclick="openGuideDirect('newb.html')" class="guide-icon-btn">
                        <div class="guide-icon-box" style="color:#d97706; background:#fffbf2;">ğŸ“œ</div>
                        <span class="guide-icon-text">ê°•í˜¸<br>ì…ë¬¸ì„œ</span>
                    </a>
                    <a onclick="openGuideDirect('guide/up.html')" class="guide-icon-btn">
                        <div class="guide-icon-box" style="color:#dc2626; background:#fef2f2;">ğŸ“ˆ</div>
                        <span class="guide-icon-text">ìœ¡ì„±<br>ê°€ì´ë“œ</span>
                    </a>
                    <a onclick="openGuideDirect('moon.html')" class="guide-icon-btn">
                        <div class="guide-icon-box" style="color:#4b5563; background:#f3f4f6;">ğŸ›ï¸</div>
                        <span class="guide-icon-text">ë¬¸íŒŒ<br>ì…ë¬¸</span>
                    </a>
                    <a onclick="openGuideDirect('guide/weapon.html')" class="guide-icon-btn">
                        <div class="guide-icon-box" style="color:#2563eb; background:#eff6ff;">âš”ï¸</div>
                        <span class="guide-icon-text">ì¥ë¹„<br>ë„ê°</span>
                    </a>
                    <a onclick="openGuideDirect('tier_weapon.html')" class="guide-icon-btn">
                        <div class="guide-icon-box" style="color:#7c3aed; background:#f5f3ff;">ğŸŒ€</div>
                        <span class="guide-icon-text">ë¬´ê³µ<br>ë„ê°</span>
                    </a>
                    <a onclick="openGuideDirect('majang.html')" class="guide-icon-btn">
                        <div class="guide-icon-box" style="color:#be123c; background:#fff1f2;">ğŸ€„</div>
                        <span class="guide-icon-text">ë§ˆì‘<br>ê°€ì´ë“œ</span>
                    </a>
                </div>
                <div class="guide-indicators" id="guide-dots">
                    <div class="g-dot active"></div>
                    <div class="g-dot"></div>
                </div>
            </section>

            <section class="toss-section">
                <div class="section-header">
                    <h3 class="section-title">ì˜¤ëŠ˜ì˜ í•  ì¼</h3>
                </div>
                <div id="home-timer-swipe" class="h-scroll-wrapper no-scrollbar">
                    <div style="padding:10px; color:var(--text-sub);">ë¡œë”© ì¤‘...</div>
                </div>
                <div class="section-footer-btn" onclick="switchTab('todo')">ì „ì²´ ë³´ê¸°</div>
            </section>

            <section class="toss-section">
                <div class="section-header">
                    <h3 class="section-title">ë¬´ë¦¼ë¡</h3>
                </div>
                <div id="home-mansarok-swipe" class="h-scroll-wrapper no-scrollbar"></div>
                <div class="section-footer-btn" onclick="switchTab('quest')">ì „ì²´ ë³´ê¸°</div>
            </section>

            <section class="toss-section">
                <div class="section-header">
                    <h3 class="section-title">ì²œì§€ë¡</h3>
                </div>
                <div id="home-chunji-swipe" class="h-scroll-wrapper no-scrollbar"></div>
                <div class="section-footer-btn" onclick="switchTab('chunji')">ì „ì²´ ë³´ê¸°</div>
            </section>

            <section class="toss-section" style="border-bottom:none;">
                <div class="section-header"><h3 class="section-title">ì¸ê¸° ì ìˆ˜</h3></div>
                <div class="flex overflow-x-auto gap-3 no-scrollbar" style="padding-bottom: 10px;">
                    <a onclick="location.href='https://wwm.tips/?q=193'" class="flex-none w-28 bg-white border border-gray-50 shadow-sm p-3 flex flex-col items-center cursor-pointer active:scale-95 transition-transform" style="border-radius:12px;">
                        <div class="w-full aspect-square bg-gray-50 flex items-center justify-center mb-2" style="border-radius:8px;"><img src="images/em/10.png" onerror="this.src='images/logo.png'" class="h-10 object-contain"></div>
                        <span class="text-[11px] font-bold text-gray-700 truncate w-full text-center">ë§ë ¹ ê³µì</span>
                    </a>
                    <a onclick="location.href='https://wwm.tips/?q=198'" class="flex-none w-28 bg-white border border-gray-50 shadow-sm p-3 flex flex-col items-center cursor-pointer active:scale-95 transition-transform" style="border-radius:12px;">
                        <div class="w-full aspect-square bg-gray-50 flex items-center justify-center mb-2" style="border-radius:8px;"><img src="images/em/4.png" onerror="this.src='images/logo.png'" class="h-10 object-contain"></div>
                        <span class="text-[11px] font-bold text-gray-700 truncate w-full text-center">ì—°ì‹¬</span>
                    </a>
                </div>
            </section>
        </div>

        <div id="view-todo" style="display: none;" class="px-4 pt-4">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-2"><span class="deco-bar"></span><h2 class="text-xl font-bold" style="color:var(--text-main);">ê°•í˜¸ ì‹œì‹œê°ê°</h2></div>
                <span id="server-time" class="text-xs text-gray-400 font-mono bg-white px-2 py-1 border border-gray-100 shadow-sm" style="border-radius:4px;">00:00:00</span>
            </div>
            <div id="gangho-timer-list-tab" class="space-y-3"></div>
        </div>

        <div id="view-quest" style="display: none;" class="px-4 pt-4">
            <div id="quest-list-view">
                <div class="filter-bar-wrapper mb-4 flex gap-2 overflow-x-auto no-scrollbar">
                    <select id="quest-type-select" class="bg-white border border-gray-200 text-sm p-2" style="border-radius:8px;" onchange="onQuestTypeChange()"><option value="all">ì „ì²´</option><option value="ë§Œì‚¬ë¡">ë§Œì‚¬ë¡</option><option value="íƒìƒ‰">íƒìƒ‰</option><option value="ì¸ì—°ì˜ ê¶¤ì ">ì¸ì—°ì˜ ê¶¤ì </option><option value="ì§€ê³¼">ì§€ê³¼</option></select>
                    <select id="quest-location-select" class="bg-white border border-gray-200 text-sm p-2" style="border-radius:8px;" onchange="applyQuestFilter()"><option value="all">ëª¨ë“  ì§€ì—­</option></select>
                </div>
                <div id="quest-grid-container"></div>
                <div id="pagination-container"></div>
            </div>
            <div id="quest-detail-view" style="display:none;">
                <div id="quest-content-loader"></div>
            </div>
        </div>

        <div id="view-chunji" style="display: none;" class="px-4 pt-4">
            <div id="chunji-list-view">
                <div class="mb-4 flex gap-2">
                    <select id="chunji-type-select" class="bg-white border border-gray-200 text-sm p-2" style="border-radius:8px;" onchange="onChunjiTypeChange()"><option value="all">ì „ì²´</option><option value="ë³‘ê¸°">ë³‘ê¸°</option><option value="í’ë¬¼">í’ë¬¼</option></select>
                    <select id="chunji-subtype-select" class="bg-white border border-gray-200 text-sm p-2" style="border-radius:8px;" onchange="applyChunjiFilter()"><option value="all">ëª¨ë“  í•­ëª©</option></select>
                </div>
                <div id="chunji-list-container" class="grid grid-cols-2 gap-2 pb-20"></div>
                <div id="chunji-pagination-container"></div>
            </div>
            <div id="chunji-detail-view" style="display:none;">
                <div id="chunji-detail-content"></div>
            </div>
        </div>

        <div id="view-quiz" style="display: none;" class="px-4 pt-4">
            <div id="quiz-counter-area" class="text-sm text-gray-500 mb-2">ë°ì´í„° ë¡œë”© ì¤‘...</div>
            <input type="text" id="quiz-local-search" class="w-full bg-white border border-gray-200 p-3 mb-4 text-sm" style="border-radius:8px;" placeholder="ë‹¨ì„œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê°€ì‹œ)">
            <table class="answer-table w-full"><tbody id="quiz-table-body"></tbody></table>
        </div>
        
        <div id="view-archive" style="display: none;" class="px-4 pt-4"><div id="archive-grid-container"></div></div>
        <div id="view-guide" style="display: none;" class="px-4 pt-4"><div id="guide-content-loader"></div><div id="guide-dynamic-content"></div></div>
        <div id="view-code" style="display: none;" class="px-4 pt-4"><div id="code-content-loader"></div></div> 
        <div id="view-builder" style="display: none;" class="px-4 pt-4"><div id="tools-menu"><div id="build-list-container"></div></div><div id="builder-interface" style="display:none;"></div></div>
        <div id="view-map-detail" style="display: none; height: 100vh;"><iframe id="map-iframe" class="w-full h-full border-0"></iframe></div>
    </main>

    <nav class="bottom-nav">
        <div id="nav-home" onclick="switchTab('home')" class="nav-btn active">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg><span>í™ˆ</span>
        </div>
        <div id="nav-quest" onclick="switchTab('quest')" class="nav-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span>ë¬´ë¦¼ë¡</span>
        </div>
        <div id="nav-todo" onclick="switchTab('todo')" class="nav-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg><span>í•  ì¼</span>
        </div>
        <div id="nav-quiz" onclick="switchTab('quiz')" class="nav-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><span>ìŠ¤ë¬´ê³ ê°œ</span>
        </div>
    </nav>

    <div id="timer-sheet-modal">
        <div class="bottom-sheet-overlay absolute inset-0" onclick="closeTimerSheet()"></div>
        <div class="sheet-container">
            <div class="sheet-handle"></div>
            <div class="sheet-header flex justify-between items-center mb-6">
                <h3 id="timer-sheet-title" class="text-xl font-bold" style="color:var(--text-main);">ëª©ë¡</h3>
                <button onclick="closeTimerSheet()" class="w-8 h-8 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center">âœ•</button>
            </div>
            <div id="timer-detail-content"></div>
        </div>
    </div>

    <div id="person-bottom-sheet">
        <div class="bottom-sheet-overlay absolute inset-0" onclick="closePersonDetail()"></div>
        <div class="bottom-sheet-content">
            <div id="person-detail-body"></div>
        </div>
    </div>

    <div id="info-modal" class="hidden fixed inset-0 bg-black/50 z-[2000] flex items-center justify-center p-4" onclick="closeInfoModal()">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm" onclick="event.stopPropagation()">
            <div class="flex items-center gap-4 mb-4"><img id="modal-img" src="" class="w-16 h-16 object-contain border rounded-lg"><h3 id="modal-name" class="text-lg font-bold"></h3></div>
            <p id="modal-desc" class="text-sm text-gray-600 leading-relaxed"></p>
            <button onclick="closeInfoModal()" class="w-full mt-4 bg-gray-100 py-3 rounded-xl font-bold text-gray-700">ë‹«ê¸°</button>
        </div>
    </div>

    <script src="hw.js"></script>
    <script src="script.js"></script>
    <script src="timer.js"></script>

    <script>
        // [ë°ì´í„° ì§ì ‘ ë¡œë“œ í•¨ìˆ˜] - script.js ì˜ì¡´ì„± ë‚®ì¶¤
        async function loadDataDirectly() {
            // ë¬´ë¦¼ë¡ ë°ì´í„° ë¡œë“œ
            try {
                const qRes = await fetch('json/quests.json');
                const qData = await qRes.json();
                window.globalData = window.globalData || {};
                window.globalData.quests = qData; // ì „ì—­ ë³€ìˆ˜ ë™ê¸°í™”
                renderMansarokDirect(qData);
            } catch(e) { console.error("ë¬´ë¦¼ë¡ ë¡œë“œ ì‹¤íŒ¨", e); }

            // ì²œì§€ë¡ ë°ì´í„° ë¡œë“œ
            try {
                const cRes = await fetch('json/chunji.json');
                const cData = await cRes.json();
                window.chunjiData = cData; // ì „ì—­ ë³€ìˆ˜ ë™ê¸°í™”
                renderChunjiDirect(cData);
            } catch(e) { console.error("ì²œì§€ë¡ ë¡œë“œ ì‹¤íŒ¨", e); }
        }

        // [ë¬´ë¦¼ë¡ ë Œë”ë§ (í™ˆ + íƒ­)]
        function renderMansarokDirect(data) {
            const homeSwipe = document.getElementById('home-mansarok-swipe');
            const tabList = document.getElementById('mansarok-list');
            const filtered = data.filter(item => !['ì§€ê³¼', 'ë³´ìŠ¤ ê³µëµ'].includes(item.type));
            
            // 1. í™ˆ ìŠ¤ì™€ì´í”„ (9ê°œ)
            if(homeSwipe) {
                homeSwipe.innerHTML = '';
                filtered.slice(0, 9).forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'h-scroll-item';
                    div.onclick = () => { switchTab('quest'); loadQuestDetail(item.filepath, item.id); };
                    const loc = item.location || 'ë¬´ë¦¼';
                    div.innerHTML = `<div class="h-item-icon">ğŸ“œ</div><div class="h-item-title">${item.name}</div><div class="h-item-sub">${loc}</div>`;
                    homeSwipe.appendChild(div);
                });
            }

            // 2. íƒ­ ë¦¬ìŠ¤íŠ¸ (ì´ˆê¸° 20ê°œë§Œ ë Œë”ë§, ì „ì²´ëŠ” script.jsì˜ renderQuestListê°€ ë‹´ë‹¹)
            if(tabList) {
                tabList.innerHTML = '';
                filtered.slice(0, 20).forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'mansarok-btn';
                    div.onclick = () => { switchTab('quest'); loadQuestDetail(item.filepath, item.id); };
                    const locBadge = item.location ? `<span class="list-loc-badge">[${item.location}]</span>` : '';
                    div.innerHTML = `${locBadge}<span>${item.name}</span>`;
                    tabList.appendChild(div);
                });
            }
        }

        // [ì²œì§€ë¡ ë Œë”ë§ (í™ˆ + íƒ­)]
        function renderChunjiDirect(data) {
            const homeSwipe = document.getElementById('home-chunji-swipe');
            const tabList = document.getElementById('chunji-list-container'); // ì—¬ê¸°ì„œëŠ” ì„ì‹œë¡œ ë³´ì—¬ì£¼ê³  script.jsê°€ ë®ì–´ì”€
            
            // 1. í™ˆ ìŠ¤ì™€ì´í”„ (9ê°œ)
            if(homeSwipe) {
                homeSwipe.innerHTML = '';
                data.slice(0, 9).forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'h-scroll-item';
                    div.onclick = () => { switchTab('chunji'); renderChunjiDetailOverride(item.id); };
                    div.innerHTML = `<div class="h-item-icon">ğŸº</div><div class="h-item-title">${item.title}</div><div class="h-item-sub">${item.type}</div>`;
                    homeSwipe.appendChild(div);
                });
            }
        }

        // [ê°€ì´ë“œ ìŠ¤í¬ë¡¤ ì¸ë””ì¼€ì´í„°]
        const guideScroll = document.querySelector('.guide-scroll-container');
        const guideDots = document.querySelectorAll('.g-dot');
        if(guideScroll) {
            guideScroll.addEventListener('scroll', () => {
                const scrollLeft = guideScroll.scrollLeft;
                const width = guideScroll.scrollWidth - guideScroll.clientWidth;
                const percent = scrollLeft / width;
                if(percent > 0.5) {
                    guideDots[0].classList.remove('active');
                    guideDots[1].classList.add('active');
                } else {
                    guideDots[1].classList.remove('active');
                    guideDots[0].classList.add('active');
                }
            });
        }

        // [í—¤ë” ëª¨ë“œ ë³€ê²½ í•¨ìˆ˜]
        function setHeaderMode(mode, returnAction) {
            const mainHeader = document.getElementById('header-main-mode');
            const detailHeader = document.getElementById('header-detail-mode');
            const backBtn = document.getElementById('header-back-action');

            if(mode === 'detail') {
                mainHeader.style.display = 'none';
                detailHeader.style.display = 'flex';
                backBtn.onclick = returnAction;
            } else {
                mainHeader.style.display = 'flex';
                detailHeader.style.display = 'none';
            }
        }

        function toggleSidebar() { 
            document.getElementById('main-sidebar').classList.add('active'); 
            document.getElementById('sidebar-overlay').classList.add('active');
            document.body.style.overflow = 'hidden'; 
        }
        function closeSidebar() { 
            document.getElementById('main-sidebar').classList.remove('active'); 
            document.getElementById('sidebar-overlay').classList.remove('active');
            document.body.style.overflow = ''; 
        }
        
        function openGuideDirect(url) {
            if (typeof loadGuideContent === 'function') {
                loadGuideContent(url); 
                switchTab('guide');
            } else { switchTab('guide'); }
        }
        
        function closeTimerSheet() { 
            document.getElementById('timer-sheet-modal').classList.remove('show'); 
            document.body.style.overflow = ''; 
        }
        function closePersonDetail() { 
            document.getElementById('person-bottom-sheet').classList.remove('active'); 
            document.body.style.overflow = ''; 
        }

        // [ë¬´ë¦¼ë¡ ìƒì„¸]
        window.renderQuestDetailOverride = function(id) {
            document.getElementById('quest-list-view').style.display = 'none';
            document.getElementById('quest-detail-view').style.display = 'block';
            window.scrollTo(0,0);
            
            setHeaderMode('detail', () => switchTab('quest'));

            const quest = (window.globalData && window.globalData.quests) ? window.globalData.quests.find(q => q.id == id) : null;
            if(!quest) return;

            let html = `
                <h2 class="text-xl font-bold mb-2">${quest.title}</h2>
                <div class="flex gap-2 mb-4">
                    <span class="text-xs bg-gray-100 px-2 py-1 rounded text-gray-600">${quest.type}</span>
                    <span class="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded">${quest.location}</span>
                </div>
                <div class="text-sm text-gray-700 leading-relaxed whitespace-pre-line">${quest.content || 'ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.'}</div>
                ${quest.image ? `<img src="${quest.image}" class="mt-4 w-full rounded-xl border" style="border-radius:0;">` : ''}
            `;

            let navHtml = '<div class="nav-btn-row">';
            // ë‹¨ìˆœí™”ëœ ë„¤ë¹„ê²Œì´ì…˜ (ì´ì „/ë‹¤ìŒ ID ê³„ì‚°ì€ ë³µì¡í•˜ë¯€ë¡œ ìƒëµí•˜ê±°ë‚˜ script.jsì˜ ë¡œì§ í™œìš©)
            navHtml += `<div onclick="switchTab('quest')" class="nav-move-btn" style="width:100%; text-align:center;">ëª©ë¡ìœ¼ë¡œ</div>`;
            navHtml += '</div>';

            document.getElementById('quest-content-loader').innerHTML = html + navHtml;
        };
        window.renderQuestDetail = window.renderQuestDetailOverride;

        // [ì²œì§€ë¡ ìƒì„¸]
        window.renderChunjiDetailOverride = function(id) {
            document.getElementById('chunji-list-view').style.display = 'none';
            document.getElementById('chunji-detail-view').style.display = 'block';
            window.scrollTo(0,0);

            setHeaderMode('detail', () => switchTab('chunji'));

            const item = window.chunjiData ? window.chunjiData.find(c => c.id == id) : null;
            if(!item) return;

            const imgTag = (src) => src ? `<img src="${src}" class="cd-img" onerror="this.style.display='none'">` : '';

            let bodyHtml = '';
            if (item.get || item.getimg1 || item.getimg2) {
                bodyHtml += `
                    <div class="cd-section">
                        <h3 class="cd-subtitle">íšë“ ë°©ë²•</h3>
                        <p class="cd-text">${item.get || ''}</p>
                        <div class="cd-img-container ${item.getimg1 && item.getimg2 ? 'grid-2' : ''}">
                            ${imgTag(item.getimg1)}
                            ${imgTag(item.getimg2)}
                        </div>
                    </div>`;
            }
            if (item.dsec || item.dsecimg1 || item.dsecimg2) {
                bodyHtml += `
                    <div class="cd-section">
                        <h3 class="cd-subtitle">ìƒì„¸ ë‚´ìš©</h3>
                        <p class="cd-text">${item.dsec || ''}</p>
                        <div class="cd-img-container ${item.dsecimg1 && item.dsecimg2 ? 'grid-2' : ''}">
                            ${imgTag(item.dsecimg1)}
                            ${imgTag(item.dsecimg2)}
                        </div>
                    </div>`;
            }
            if (!item.get && !item.dsec && !item.getimg1 && !item.dsecimg1) {
                const descText = item.content || item.desc || "ìƒì„¸ ë‚´ìš©ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.";
                bodyHtml += `
                    <div class="cd-section">
                        <h3 class="cd-subtitle">ì„¤ëª…</h3>
                        <p class="cd-text">${descText}</p>
                        ${item.image ? `<img src="${item.image}" class="cd-img mt-2">` : ''}
                    </div>`;
            }

            let html = `
                <div class="chunji-detail-card">
                    <div class="cd-header">
                        <span class="cd-badge">ì²œì§€ë¡</span>
                        <h2 class="cd-title">${item.title}</h2>
                    </div>
                    ${bodyHtml}
                </div>
            `;
            
            let navHtml = '<div class="nav-btn-row">';
             navHtml += `<div onclick="switchTab('chunji')" class="nav-move-btn" style="width:100%; text-align:center;">ëª©ë¡ìœ¼ë¡œ</div>`;
            navHtml += '</div>';

            document.getElementById('chunji-detail-content').innerHTML = html + navHtml;
        };
        window.loadChunjiDetail = window.renderChunjiDetailOverride;
        window.showChunjiDetail = window.renderChunjiDetailOverride;


        // [íƒ€ì´ë¨¸ ì˜¤ë²„ë¼ì´ë“œ]
        window.updateTimers = function() {
            const homeContainer = document.getElementById('home-timer-swipe');
            const tabContainer = document.getElementById('gangho-timer-list-tab');

            // TIMERSê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ëŒ€ê¸°
            if (typeof TIMERS === 'undefined') return;

            const now = new Date();
            const statusData = (typeof getCheckStatus === 'function') ? getCheckStatus() : { checked: {} };
            const serverTimeEl = document.getElementById('server-time');
            if (serverTimeEl) serverTimeEl.innerText = now.toTimeString().split(' ')[0];

            let htmlSwipe = '';
            let htmlList = '';

            TIMERS.forEach(timer => {
                let timeText = "";
                let isUrgent = false;
                let progressText = ""; 

                if (timer.type === 'reset') {
                    const target = getNextReset(timer.freq, now);
                    const diff = target - now;
                    timeText = formatTime(diff);
                    if (diff < 3 * 60 * 60 * 1000) isUrgent = true;

                    const tasks = TASK_DATA.filter(t => t.freq === timer.freq);
                    if (tasks.length > 0) {
                        const done = tasks.filter(t => statusData.checked[t.id]).length;
                        progressText = `[${done}/${tasks.length}]`;
                    }
                } 
                else if (timer.type === 'daily_operating') {
                    const h = now.getHours();
                    if (h >= 5 && h < 7) timeText = "íœ´ì¥ ì¤‘";
                    else timeText = "ìš´ì˜ ì¤‘";
                }
                else {
                    timeText = "ì‹œê°„ í™•ì¸";
                }

                // ìŠ¤ì™€ì´í”„ ì¹´ë“œ (í™ˆ)
                htmlSwipe += `
                    <div class="h-scroll-item timer-h-card ${isUrgent ? 'urgent' : ''}" onclick="openTimerSheetByName('${timer.name}')">
                        <div class="h-item-icon">â°</div>
                        <div class="h-item-title"><span style="color:#3182f6; margin-right:4px;">${progressText}</span>${timer.name}</div>
                        <div class="h-item-sub" style="margin-top:auto; font-weight:700; color:${isUrgent ? '#e53935':'#3182f6'}">${timeText}</div>
                    </div>
                `;

                // ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ (íƒ­)
                htmlList += `
                    <div class="timer-row" onclick="openTimerSheetByName('${timer.name}')">
                        <div class="timer-icon-box">â°</div>
                        <div class="timer-info">
                            <div class="timer-name">
                                <span class="timer-progress-text">${progressText}</span>
                                ${timer.name}
                            </div>
                            <div class="timer-desc">
                                <span>${timer.desc}</span>
                            </div>
                        </div>
                        <div class="timer-clock ${isUrgent ? 'urgent' : ''}">${timeText}</div>
                    </div>
                `;
            });
            
            if(homeContainer) homeContainer.innerHTML = htmlSwipe;
            if(tabContainer) tabContainer.innerHTML = htmlList;
        };
        window.openTimerSheetByName = function(name) {
            const timer = TIMERS.find(t => t.name === name);
            if(timer) openTimerSheet(timer);
        }

        window.switchTab = function(tabName) {
            // íƒ­ ì „í™˜ ì‹œ í•­ìƒ ë©”ì¸ í—¤ë”ë¡œ ë³µê·€
            setHeaderMode('main');
            
            const views = ['view-home', 'view-quest', 'view-chunji', 'view-quiz', 'view-archive', 'view-news', 'view-guide', 'view-code', 'view-builder', 'view-map-detail', 'view-todo'];
            views.forEach(v => { 
                const el = document.getElementById(v);
                if(el) el.style.display = (v === 'view-' + tabName) ? 'block' : 'none'; 
            });
            
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.getElementById('nav-' + tabName);
            if(activeBtn) activeBtn.classList.add('active');
            
            if (tabName === 'todo' && typeof updateTimers === 'function') {
                updateTimers();
            }
            else if (tabName === 'quiz') {
                const tbody = document.getElementById('quiz-table-body');
                if (typeof globalData !== 'undefined' && globalData.quiz && tbody && tbody.children.length === 0) {
                    if(typeof renderQuizTable === 'function') renderQuizTable(globalData.quiz);
                    if(typeof updateQuizCounter === 'function') updateQuizCounter();
                }
            } else if (tabName === 'quest') {
                const container = document.getElementById('quest-grid-container');
                if (typeof globalData !== 'undefined' && globalData.quests && container && container.children.length === 0) {
                    if(typeof renderQuestList === 'function') renderQuestList();
                }
                if(typeof showQuestList === 'function') showQuestList();
            } else if (tabName === 'chunji') {
                if(typeof renderChunjiListOverride === 'function') {
                    renderChunjiListOverride(); 
                } else if(typeof renderChunjiList === 'function') {
                    renderChunjiList();
                }
                if(typeof showChunjiList === 'function') showChunjiList();
            }
            
            window.scrollTo(0, 0);
            if (typeof updateUrlQuery === 'function') {
                updateUrlQuery(tabName);
            }
        };

        setInterval(function() {
            if (typeof updateTimers === 'function') {
                updateTimers();
            }
        }, 1000);
        
        window.addEventListener('DOMContentLoaded', () => {
             loadDataDirectly(); // ë°ì´í„° ê°•ì œ ë¡œë“œ
        });
    </script>
</body>
</html>
