<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì—°ìš´: í•œêµ­ ìœ„í‚¤</title>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5SMVDZTDST"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-5SMVDZTDST');
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        /* [ê¸°ë³¸ ì„¤ì •] - ë°°ê²½ìƒ‰ íšŒìƒ‰ í†µì¼ */
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f2f4f6; color: #191f28; -webkit-tap-highlight-color: transparent; padding-bottom: 80px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* [í—¤ë”] - ë°°ê²½ìƒ‰ì„ bodyì™€ ë™ì¼í•˜ê²Œ ë³€ê²½ (#f2f4f6) */
        .app-header { background: #f2f4f6; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 50; height: 60px; }
        .header-default { width: 100%; display: flex; align-items: center; justify-content: space-between; }
        .app-logo { font-size: 22px; font-weight: 900; color: #191f28; letter-spacing: -0.5px; }
        .header-actions { display: flex; align-items: center; gap: 8px; }
        
        /* ê²€ìƒ‰ ëª¨ë“œ (í™œì„± ì‹œ ë°°ê²½ í°ìƒ‰ìœ¼ë¡œ ì „í™˜ íš¨ê³¼) */
        .header-search-mode { width: 100%; display: none; align-items: center; }
        .header-search-box { flex: 1; background: #fff; border-radius: 0; height: 40px; display: flex; align-items: center; padding: 0 12px; }
        .header-search-input { background: transparent; border: none; width: 100%; height: 100%; font-size: 15px; outline: none; color: #333; margin-left: 8px; }
        
        .header-icon-btn { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; color: #333; cursor: pointer; border-radius: 0; transition: background 0.2s; }
        .header-icon-btn:active { background: #e5e7eb; }

        /* [ê²€ìƒ‰ ê²°ê³¼ì°½] */
        #global-search-results { display: none; position: absolute; top: 60px; left: 0; right: 0; background: white; border-radius: 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1); z-index: 60; border-top: 1px solid #eee; max-height:300px; overflow-y:auto; padding: 10px 0; }
        .search-result-item { padding: 12px 20px; border-bottom: 1px solid #f9f9f9; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .badge { padding: 2px 6px; border-radius: 0; font-size: 10px; font-weight: bold; color: white; }
        .badge.quiz { background: #f59e0b; } .badge.item { background: #3b82f6; } .badge.info { background: #10b981; }

        /* [ì²­í¬(Chunk) ìŠ¤íƒ€ì¼] - No Radius, Full Width, White Background */
        .toss-section { 
            background: #fff; 
            border-radius: 0; 
            padding: 24px 20px; 
            margin: 0; 
            border-bottom: 12px solid #f2f4f6; /* ì„¹ì…˜ ì‚¬ì´ ê°„ê²© ì—­í•  */
        }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .section-title { font-size: 20px; font-weight: 800; color: #191f28; }
        
        /* [ë²„íŠ¼] íŒŒë€ìƒ‰ ìœ ì§€ */
        .section-footer-btn {
            display: block; width: 100%; text-align: center; 
            padding: 14px 0; margin-top: 10px;
            color: #3182f6; /* íŒŒë€ìƒ‰ í…ìŠ¤íŠ¸ */
            font-size: 14px; font-weight: 600; 
            background: #f2f8ff; /* ì—°í•œ íŒŒë€ ë°°ê²½ */
            border-radius: 0; 
            cursor: pointer;
            transition: background 0.2s;
        }
        .section-footer-btn:active { background: #e1f0ff; }

        /* [ìŠ¬ë¼ì´ë”] */
        .hero-section { margin: 0; border-radius: 0; overflow: hidden; border-bottom: 12px solid #f2f4f6; }
        .hero-slider-wrapper { position: relative; width: 100%; aspect-ratio: 21/10; background: #e5e7eb; border-radius: 0; }
        .slider-track { display: flex; height: 100%; transition: transform 0.5s ease-in-out; }
        .hero-slide { flex: none; width: 100%; height: 100%; background-size: cover; background-position: center; position: relative !important; cursor: pointer; }
        .slide-content { position: absolute; bottom: 0; left: 0; right: 0; padding: 20px; background: linear-gradient(transparent, rgba(0,0,0,0.8)); color: white; z-index: 10; }
        .slide-title { font-size: 18px; font-weight: bold; margin-bottom: 4px; }
        .slide-tag { font-size: 10px; background: #3182f6; padding: 2px 6px; border-radius: 0; margin-bottom: 4px; display: inline-block; }
        .slide-link-btn { display:none; }
        .indicator { width: 6px; height: 6px; border-radius: 0; background: rgba(255,255,255,0.4); cursor: pointer; }
        .indicator.active { width: 18px; background: white; border-radius: 0; }

        /* [ê°€ì´ë“œ ì•„ì´ì½˜ ê·¸ë¦¬ë“œ] */
        .guide-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .guide-icon-btn { display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: transform 0.1s; }
        .guide-icon-btn:active { transform: scale(0.95); }
        .guide-icon-box { 
            width: 52px; height: 52px; border-radius: 16px; 
            background: #f9fafb; display: flex; align-items: center; justify-content: center; 
            font-size: 24px; margin-bottom: 8px; border: 1px solid #f2f4f6;
        }
        .guide-icon-text { font-size: 12px; color: #4e5968; font-weight: 600; text-align: center; line-height: 1.3; }

        /* [ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ] - ë¬´ë¦¼ë¡/ì²œì§€ë¡ */
        .mansarok-btn, .chunji-item-card { 
            display: flex !important; align-items: center; justify-content: space-between !important; 
            padding: 16px 0 !important; border-bottom: 1px solid #f2f4f6 !important; 
            background: transparent !important; box-shadow: none !important; 
            border: none !important; border-radius: 0 !important;
            margin-bottom: 0 !important; width: 100% !important; height: auto !important; min-height: auto !important;
            flex-direction: row !important; gap: 8px !important;
        }
        .mansarok-btn:last-child, .chunji-item-card:last-child { border-bottom: none !important; }
        
        /* [â˜…ì¶”ê°€] ì§€ì—­ ë±ƒì§€ ìŠ¤íƒ€ì¼ */
        .list-loc-badge {
            font-size: 11px; color: #8b95a1; background: #f2f4f6; 
            padding: 2px 6px; border-radius: 4px; font-weight: 600; margin-right: 4px; flex-shrink: 0;
        }

        .mansarok-btn span, .chunji-card-title { 
            font-size: 16px; font-weight: 600; color: #333; text-align: left;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .mansarok-btn::after, .chunji-item-card::after {
            content: 'â€º'; font-size: 22px; color: #d1d5db; font-weight: 300; margin-left: auto;
        }

        /* [â˜…ìˆ˜ì •] íƒ€ì´ë¨¸ ë¦¬ìŠ¤íŠ¸ - [0/4] í‘œì‹œë¥¼ ìœ„í•´ êµ¬ì¡° ë³€ê²½ */
        .timer-row {
            background-color: #fff; border-bottom: 1px solid #f2f4f6; 
            border-radius: 0; padding: 16px 0; margin-bottom: 0;
            display: flex; justify-content: space-between; align-items: center; cursor: pointer;
        }
        .timer-info { display: flex; flex-direction: column; gap: 2px; flex: 1; }
        
        /* íƒ€ì´ë¨¸ ì•„ì´ì½˜ (ê°€ìƒìš”ì†Œ) */
        .timer-row::before {
            content: 'â°';
            display: flex; align-items: center; justify-content: center;
            width: 40px; height: 40px;
            background: #fff1f1; /* ì—°í•œ ë¹¨ê°• ë°°ê²½ */
            font-size: 20px;
            border-radius: 12px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .timer-name { font-size: 15px; font-weight: 700; color: #191f28; display: flex; align-items: center; gap: 4px; }
        .timer-desc { font-size: 12px; color: #8b95a1; }
        .timer-clock { font-family: 'Roboto Mono', monospace; font-size: 14px; font-weight: 700; color: #3182f6; } 
        .timer-clock.urgent { color: #e53935; }
        
        /* [â˜…ìˆ˜ì •] ì§„í–‰ë„ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .timer-progress-text { 
            font-size: 12px; font-weight: 700; color: #3182f6; 
            margin-right: 4px;
        }
        .status-badge { display: none; } /* ë±ƒì§€ ìˆ¨ê¹€ */

        /* [í•˜ë‹¨ íƒ­ë°”] */
        .bottom-nav { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); 
            border-top: 1px solid #eee; padding: 8px 20px 20px 20px; 
            display: flex; justify-content: space-between; z-index: 100; 
        }
        .nav-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; color: #b0b8c1; width: 60px; cursor: pointer; }
        .nav-btn svg { width: 24px; height: 24px; }
        .nav-btn span { font-size: 10px; font-weight: 500; }
        .nav-btn.active { color: #191f28; }
        .nav-btn.active span { font-weight: 700; }

        /* [ë°”í…€ì‹œíŠ¸ ë° ê¸°íƒ€] */
        #timer-sheet-modal, #person-bottom-sheet { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9999; display: none; opacity: 0; transition: opacity 0.2s; backdrop-filter: blur(2px); }
        #timer-sheet-modal.show, #person-bottom-sheet.active { display: block; opacity: 1; }
        .sheet-container, .bottom-sheet-content { position: absolute; bottom: 0; width: 100%; background: white; border-top-left-radius: 0; border-top-right-radius: 0; padding: 24px 24px 40px 24px; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1); max-height: 85vh; overflow-y: auto; box-shadow: 0 -4px 20px rgba(0,0,0,0.1); }
        #timer-sheet-modal.show .sheet-container, #person-bottom-sheet.active .bottom-sheet-content { transform: translateY(0); }
        .sheet-handle, .sheet-handle-bar { width: 40px; height: 4px; background: #e0e0e0; border-radius: 0; margin: 0 auto 24px auto; }

        /* ì²œì§€ë¡ ìƒì„¸ í™”ë©´ */
        .chunji-detail-card { background-color: white; border-radius: 0; padding: 24px; box-shadow: none; border-bottom: 1px solid #f2f4f6; margin-bottom: 0; }
        .cd-header { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .cd-title { font-size: 22px; font-weight: 800; color: #191f28; margin-bottom: 6px; }
        .cd-badge { display: inline-block; background: #f0f4f8; color: #4e5968; font-size: 11px; padding: 3px 8px; border-radius: 0; font-weight: 600; }
        .cd-section { margin-bottom: 24px; }
        .cd-subtitle { font-size: 15px; font-weight: 700; color: #333; margin-bottom: 8px; display: flex; align-items: center; }
        .cd-subtitle::before { content: ''; display: inline-block; width: 4px; height: 14px; background: #3182f6; margin-right: 8px; border-radius: 0; }
        .cd-text { font-size: 14px; color: #555; line-height: 1.6; background: #fafafa; padding: 12px; border-radius: 0; white-space: pre-line; }
        .cd-img-container { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .cd-img { width: 100%; border-radius: 0; border: 1px solid #eee; object-fit: cover; }
        .nav-btn-row { display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; }
        .nav-move-btn { display: flex; align-items: center; gap: 5px; font-size: 14px; font-weight: 600; color: #666; padding: 8px 12px; border-radius: 0; transition: background 0.2s; }
        
        /* ì¸ë¬¼ ë°”í…€ì‹œíŠ¸ */
        .person-sheet-header { text-align: center; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        .person-img-container { display: inline-block; padding: 5px; background: white; border-radius: 0; box-shadow: none; border: 1px solid #eee; margin-bottom: 15px; }
        .person-img-large { width: 100px; height: 100px; border-radius: 0; object-fit: cover; }
        .person-info-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px dashed #eee; }
        .person-bio-box { background: #f9f9f9; padding: 16px; border-radius: 0; margin-top: 20px; }
        .person-close-btn { width: 100%; padding: 14px; background: #333; color: white; border-radius: 0; font-weight: 700; font-size: 15px; margin-top: 30px; cursor: pointer; }

        /* ê¸°íƒ€ ìŠ¤íƒ€ì¼ */
        .quest-card { background-color: white; border-radius: 0; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); border: 1px solid #f2f4f6; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: transform 0.1s; }
        .quest-card:active { transform: scale(0.99); }
        .quest-name { font-weight: 700; font-size: 15px; color: #191f28; }
        .quest-type { font-size: 12px; color: #8b95a1; }
        .quest-badge { font-size: 11px; font-weight: 600; color: #3182f6; background-color: #e8f3ff; padding: 6px 10px; border-radius: 0; }
        .answer-table { width: 100%; border-collapse: separate; border-spacing: 0; background: white; border-radius: 0; overflow: hidden; }
        .answer-table th { background: #f9fafb; padding: 12px; font-size: 13px; color: #6b7684; text-align: left; border-bottom: 1px solid #f2f4f6; }
        .answer-table td { padding: 14px 12px; font-size: 14px; color: #333; border-bottom: 1px solid #f2f4f6; }
        .highlight { color: #3182f6; font-weight: bold; }
        .pagination-controls { display: flex; justify-content: center; gap: 6px; margin-top: 20px; margin-bottom: 40px; }
        .pagination-btn { width: 32px; height: 32px; border-radius: 0; font-size: 13px; font-weight: 600; color: #8b95a1; background: transparent; }
        .pagination-btn.active { background-color: #3182f6; color: white; }

        /* ì‚¬ì´ë“œë°” */
        #main-sidebar { position: fixed; top: 0; right: -300px; width: 280px; height: 100%; background: white; z-index: 3000; transition: right 0.3s ease; box-shadow: -10px 0 20px rgba(0,0,0,0.1); }
        #main-sidebar.active { right: 0; }
        #sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); display: none; z-index: 2999; backdrop-filter: blur(2px); }
        #sidebar-overlay.active { display: block; }
    </style>
</head>

<body>
    <script>
        const EVENT_API_URL = "https://script.google.com/macros/s/AKfycbzSYkfFvOnpuL9MUWpHJk-wFa6_u8pAJW5OOVy0oYY8JK36E5n7oq7wxlMnU-vGKqBr/exec";
        const BUILD_API_URL = "https://script.google.com/macros/s/AKfycbz7c8YREyAa6aD1F3f7Hve3meAsOtjepSX_zyZLVbloj9qosdLgSArdBYFGKGYmNU2_tQ/exec";
    </script>

    <div id="sidebar-overlay" onclick="closeSidebar()"></div>

    <header id="main-header" class="app-header">
        
        <div id="header-default" class="header-default">
            <div class="app-logo">ì—°ìš´</div>
            <div class="header-actions">
                <button onclick="toggleSearchLayer(true)" class="header-icon-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </button>
                <button onclick="toggleSidebar()" class="header-icon-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                </button>
            </div>
        </div>

        <div id="header-search-layer" class="header-search-mode">
            <div class="header-search-box">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#888" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="text" id="header-search-input" placeholder="ë¬´ë¦¼ ì •ë³´ ê²€ìƒ‰" class="header-search-input" autocomplete="off">
            </div>
            <button onclick="toggleSearchLayer(false)" style="margin-left: 10px; font-size: 14px; font-weight: 600; color: #666; white-space: nowrap;">ì·¨ì†Œ</button>
        </div>
        
        <div id="global-search-results"></div>
    </header>

    <main id="main-content">
        
        <div id="view-home">
            
            <section class="hero-section">
                <div class="hero-slider-wrapper">
                    <div id="hero-slider-track" class="slider-track"></div>
                    <div id="slider-indicators" class="absolute bottom-4 left-0 right-0 flex justify-center gap-1.5"></div>
                </div>
            </section>

            <section class="toss-section">
                <div class="section-header">
                    <h3 class="section-title">ê¸°ë³¸ ê°€ì´ë“œ</h3>
                </div>
                <div class="guide-grid">
                    <a onclick="openGuideDirect('newb.html')" class="guide-icon-btn">
                        <div class="guide-icon-box" style="color:#d97706; background:#fffbf2;">ğŸ“œ</div>
                        <span class="guide-icon-text">ê°•í˜¸<br>ì…ë¬¸ì„œ</span>
                    </a>
                    <a onclick="openGuideDirect('guide/up.html')" class="guide-icon-btn">
                        <div class="guide-icon-box" style="color:#dc2626; background:#fef2f2;">ğŸ“ˆ</div>
                        <span class="guide-icon-text">ìœ¡ì„±<br>ê°€ì´ë“œ</span>
                    </a>
                    <a onclick="openGuideDirect('moon.html')" class="guide-icon-btn">
                        <div class="guide-icon-box" style="color:#4b5563; background:#f3f4f6;">ğŸ›ï¸</div>
                        <span class="guide-icon-text">ë¬¸íŒŒ<br>ì…ë¬¸</span>
                    </a>
                    <a onclick="openGuideDirect('guide/weapon.html')" class="guide-icon-btn">
                        <div class="guide-icon-box" style="color:#2563eb; background:#eff6ff;">âš”ï¸</div>
                        <span class="guide-icon-text">ì¥ë¹„<br>ë„ê°</span>
                    </a>
                    <a onclick="openGuideDirect('tier_weapon.html')" class="guide-icon-btn">
                        <div class="guide-icon-box" style="color:#7c3aed; background:#f5f3ff;">ğŸŒ€</div>
                        <span class="guide-icon-text">ë¬´ê³µ<br>ë„ê°</span>
                    </a>
                    <a onclick="openGuideDirect('majang.html')" class="guide-icon-btn">
                        <div class="guide-icon-box" style="color:#be123c; background:#fff1f2;">ğŸ€„</div>
                        <span class="guide-icon-text">ë§ˆì‘<br>ê°€ì´ë“œ</span>
                    </a>
                </div>
            </section>

            <section class="toss-section">
                <div class="section-header">
                    <h3 class="section-title">ì˜¤ëŠ˜ì˜ í•  ì¼</h3>
                </div>
                <div id="gangho-timer-list" class="flex flex-col">
                    <div style="text-align:center; color:#999; padding:20px;">ë¡œë”© ì¤‘...</div>
                </div>
                <div class="section-footer-btn" onclick="switchTab('todo')">ë” ë³´ê¸°</div>
            </section>

            <section class="toss-section">
                <div class="section-header">
                    <h3 class="section-title">ë¬´ë¦¼ë¡</h3>
                </div>
                <div id="mansarok-list" class="flex flex-col"></div>
                <div class="section-footer-btn" onclick="switchTab('quest')">ë” ë³´ê¸°</div>
            </section>

            <section class="toss-section">
                <div class="section-header">
                    <h3 class="section-title">ì²œì§€ë¡</h3>
                </div>
                <div id="home-chunji-list" class="flex flex-col"></div>
                <div class="section-footer-btn" onclick="switchTab('chunji')">ë” ë³´ê¸°</div>
            </section>

            <section class="toss-section" style="border-bottom:none;">
                <div class="section-header"><h3 class="section-title">ì¸ê¸° ì ìˆ˜</h3></div>
                <div class="flex overflow-x-auto gap-3 no-scrollbar" style="padding-bottom: 10px;">
                    <a onclick="location.href='https://wwm.tips/?q=193'" class="flex-none w-28 bg-white border border-gray-50 shadow-sm p-3 flex flex-col items-center cursor-pointer active:scale-95 transition-transform" style="border-radius:0;">
                        <div class="w-full aspect-square bg-gray-50 flex items-center justify-center mb-2" style="border-radius:0;"><img src="images/em/10.png" onerror="this.src='images/logo.png'" class="h-10 object-contain"></div>
                        <span class="text-[11px] font-bold text-gray-700 truncate w-full text-center">ë§ë ¹ ê³µì</span>
                    </a>
                    <a onclick="location.href='https://wwm.tips/?q=198'" class="flex-none w-28 bg-white border border-gray-50 shadow-sm p-3 flex flex-col items-center cursor-pointer active:scale-95 transition-transform" style="border-radius:0;">
                        <div class="w-full aspect-square bg-gray-50 flex items-center justify-center mb-2" style="border-radius:0;"><img src="images/em/4.png" onerror="this.src='images/logo.png'" class="h-10 object-contain"></div>
                        <span class="text-[11px] font-bold text-gray-700 truncate w-full text-center">ì—°ì‹¬</span>
                    </a>
                </div>
            </section>
        </div>

        <div id="view-todo" style="display: none;" class="px-4 pt-4">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-2"><span class="deco-bar"></span><h2 class="text-xl font-bold text-gray-800">ê°•í˜¸ ì‹œì‹œê°ê°</h2></div>
                <span id="server-time" class="text-xs text-gray-400 font-mono bg-white px-2 py-1 border border-gray-100 shadow-sm" style="border-radius:0;">00:00:00</span>
            </div>
            <div id="gangho-timer-list-tab" class="space-y-3"></div>
        </div>

        <div id="view-quest" style="display: none;" class="px-4 pt-4">
            <div id="quest-list-view">
                <div class="filter-bar-wrapper mb-4 flex gap-2 overflow-x-auto no-scrollbar">
                    <select id="quest-type-select" class="bg-white border border-gray-200 text-sm p-2" style="border-radius:0;" onchange="onQuestTypeChange()"><option value="all">ì „ì²´</option><option value="ë§Œì‚¬ë¡">ë§Œì‚¬ë¡</option><option value="íƒìƒ‰">íƒìƒ‰</option><option value="ì¸ì—°ì˜ ê¶¤ì ">ì¸ì—°ì˜ ê¶¤ì </option><option value="ì§€ê³¼">ì§€ê³¼</option></select>
                    <select id="quest-location-select" class="bg-white border border-gray-200 text-sm p-2" style="border-radius:0;" onchange="applyQuestFilter()"><option value="all">ëª¨ë“  ì§€ì—­</option></select>
                </div>
                <div id="quest-grid-container"></div>
                <div id="pagination-container"></div>
            </div>
            <div id="quest-detail-view" style="display:none;">
                <button class="mb-4 text-sm font-bold text-blue-600 flex items-center" onclick="showQuestList()"><svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                <div id="quest-content-loader"></div>
            </div>
        </div>

        <div id="view-chunji" style="display: none;" class="px-4 pt-4">
            <div id="chunji-list-view">
                <div class="mb-4 flex gap-2">
                    <select id="chunji-type-select" class="bg-white border border-gray-200 text-sm p-2" style="border-radius:0;" onchange="onChunjiTypeChange()"><option value="all">ì „ì²´</option><option value="ë³‘ê¸°">ë³‘ê¸°</option><option value="í’ë¬¼">í’ë¬¼</option></select>
                    <select id="chunji-subtype-select" class="bg-white border border-gray-200 text-sm p-2" style="border-radius:0;" onchange="applyChunjiFilter()"><option value="all">ëª¨ë“  í•­ëª©</option></select>
                </div>
                <div id="chunji-list-container" class="grid grid-cols-2 gap-2 pb-20"></div>
                <div id="chunji-pagination-container"></div>
            </div>
            <div id="chunji-detail-view" style="display:none;">
                <button class="mb-4 text-sm font-bold text-blue-600 flex items-center" onclick="showChunjiList()"><svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                <div id="chunji-detail-content"></div>
            </div>
        </div>

        <div id="view-quiz" style="display: none;" class="px-4 pt-4">
            <div id="quiz-counter-area" class="text-sm text-gray-500 mb-2">ë°ì´í„° ë¡œë”© ì¤‘...</div>
            <input type="text" id="quiz-local-search" class="w-full bg-white border border-gray-200 p-3 mb-4 text-sm" style="border-radius:0;" placeholder="ë‹¨ì„œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê°€ì‹œ)">
            <table class="answer-table w-full"><tbody id="quiz-table-body"></tbody></table>
        </div>
        
        <div id="view-archive" style="display: none;" class="px-4 pt-4"><div id="archive-grid-container"></div></div>
        <div id="view-guide" style="display: none;" class="px-4 pt-4"><div id="guide-content-loader"></div><div id="guide-dynamic-content"></div></div>
        <div id="view-code" style="display: none;" class="px-4 pt-4"><div id="code-content-loader"></div></div> 
        <div id="view-builder" style="display: none;" class="px-4 pt-4"><div id="tools-menu"><div id="build-list-container"></div></div><div id="builder-interface" style="display:none;"></div></div>
        <div id="view-map-detail" style="display: none; height: 100vh;"><iframe id="map-iframe" class="w-full h-full border-0"></iframe></div>
    </main>

    <nav class="bottom-nav">
        <div id="nav-home" onclick="switchTab('home')" class="nav-btn active">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg><span>í™ˆ</span>
        </div>
        <div id="nav-quest" onclick="switchTab('quest')" class="nav-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span>ë¬´ë¦¼ë¡</span>
        </div>
        <div id="nav-todo" onclick="switchTab('todo')" class="nav-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg><span>í•  ì¼</span>
        </div>
        <div id="nav-quiz" onclick="switchTab('quiz')" class="nav-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><span>ìŠ¤ë¬´ê³ ê°œ</span>
        </div>
    </nav>

    <div id="timer-sheet-modal">
        <div class="bottom-sheet-overlay absolute inset-0" onclick="closeTimerSheet()"></div>
        <div class="sheet-container">
            <div class="sheet-handle"></div>
            <div class="sheet-header flex justify-between items-center mb-6">
                <h3 id="timer-sheet-title" class="text-xl font-bold text-gray-800">ëª©ë¡</h3>
                <button onclick="closeTimerSheet()" class="w-8 h-8 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center">âœ•</button>
            </div>
            <div id="timer-detail-content"></div>
        </div>
    </div>

    <div id="person-bottom-sheet">
        <div class="bottom-sheet-overlay absolute inset-0" onclick="closePersonDetail()"></div>
        <div class="bottom-sheet-content">
            <div id="person-detail-body"></div>
        </div>
    </div>

    <div id="info-modal" class="hidden fixed inset-0 bg-black/50 z-[2000] flex items-center justify-center p-4" onclick="closeInfoModal()">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm" onclick="event.stopPropagation()">
            <div class="flex items-center gap-4 mb-4"><img id="modal-img" src="" class="w-16 h-16 object-contain border rounded-lg"><h3 id="modal-name" class="text-lg font-bold"></h3></div>
            <p id="modal-desc" class="text-sm text-gray-600 leading-relaxed"></p>
            <button onclick="closeInfoModal()" class="w-full mt-4 bg-gray-100 py-3 rounded-xl font-bold text-gray-700">ë‹«ê¸°</button>
        </div>
    </div>

    <script src="hw.js"></script>
    <script src="script.js"></script>
    <script src="timer.js"></script>

    <script>
        // ê²€ìƒ‰ ë ˆì´ì–´ í† ê¸€ í•¨ìˆ˜
        function toggleSearchLayer(show) {
            const defaultHeader = document.getElementById('header-default');
            const searchLayer = document.getElementById('header-search-layer');
            const searchInput = document.getElementById('header-search-input');
            const searchResults = document.getElementById('global-search-results');

            if (show) {
                defaultHeader.style.display = 'none';
                searchLayer.style.display = 'flex';
                searchInput.focus();
            } else {
                defaultHeader.style.display = 'flex';
                searchLayer.style.display = 'none';
                searchInput.value = '';
                if(searchResults) searchResults.style.display = 'none';
            }
        }

        function toggleSidebar() { 
            document.getElementById('main-sidebar').classList.add('active'); 
            document.getElementById('sidebar-overlay').classList.add('active');
            document.body.style.overflow = 'hidden'; 
        }
        function closeSidebar() { 
            document.getElementById('main-sidebar').classList.remove('active'); 
            document.getElementById('sidebar-overlay').classList.remove('active');
            document.body.style.overflow = ''; 
        }
        
        function openGuideDirect(url) {
            console.log("ê°€ì´ë“œ ì´ë™:", url);
            if (typeof loadGuideContent === 'function') {
                loadGuideContent(url); 
                switchTab('guide');
            } else {
                switchTab('guide');
            }
        }
        
        function closeTimerSheet() { 
            document.getElementById('timer-sheet-modal').classList.remove('show'); 
            document.body.style.overflow = ''; 
        }
        function closePersonDetail() { 
            document.getElementById('person-bottom-sheet').classList.remove('active'); 
            document.body.style.overflow = ''; 
        }

        // [â˜…ìˆ˜ì •] ë¬´ë¦¼ë¡ ìƒì„¸ ë‚´ë¶€ ë„¤ë¹„ê²Œì´ì…˜
        window.renderQuestDetailOverride = function(id) {
            document.getElementById('quest-list-view').style.display = 'none';
            document.getElementById('quest-detail-view').style.display = 'block';
            window.scrollTo(0,0);

            const quest = globalData.quests.find(q => q.id == id);
            if(!quest) return;

            let html = `
                <h2 class="text-xl font-bold mb-2">${quest.title}</h2>
                <div class="flex gap-2 mb-4">
                    <span class="text-xs bg-gray-100 px-2 py-1 rounded text-gray-600">${quest.type}</span>
                    <span class="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded">${quest.location}</span>
                </div>
                <div class="text-sm text-gray-700 leading-relaxed whitespace-pre-line">${quest.content || 'ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.'}</div>
                ${quest.image ? `<img src="${quest.image}" class="mt-4 w-full rounded-xl border" style="border-radius:0;">` : ''}
            `;

            const allIds = globalData.quests.map(q => q.id);
            const currIdx = allIds.indexOf(String(id));

            let navHtml = '<div class="nav-btn-row">';
            if (currIdx > 0) {
                navHtml += `<button onclick="renderQuestDetailOverride('${allIds[currIdx - 1]}')" class="nav-move-btn"><span class="text-lg">â†</span> ì´ì „</button>`;
            } else { navHtml += `<div></div>`; }

            if (currIdx < allIds.length - 1) {
                navHtml += `<button onclick="renderQuestDetailOverride('${allIds[currIdx + 1]}')" class="nav-move-btn">ë‹¤ìŒ <span class="text-lg">â†’</span></button>`;
            } else { navHtml += `<div></div>`; }
            navHtml += '</div>';

            document.getElementById('quest-content-loader').innerHTML = html + navHtml;
        };
        window.renderQuestDetail = window.renderQuestDetailOverride;

        // [â˜…ìˆ˜ì •] ì²œì§€ë¡ ìƒì„¸ í™”ë©´
        window.renderChunjiDetailOverride = function(id) {
            document.getElementById('chunji-list-view').style.display = 'none';
            document.getElementById('chunji-detail-view').style.display = 'block';
            window.scrollTo(0,0);

            const item = chunjiData.find(c => c.id == id);
            if(!item) return;

            const imgTag = (src) => src ? `<img src="${src}" class="cd-img" onerror="this.style.display='none'">` : '';

            let bodyHtml = '';
            if (item.get || item.getimg1 || item.getimg2) {
                bodyHtml += `
                    <div class="cd-section">
                        <h3 class="cd-subtitle">íšë“ ë°©ë²•</h3>
                        <p class="cd-text">${item.get || ''}</p>
                        <div class="cd-img-container ${item.getimg1 && item.getimg2 ? 'grid-2' : ''}">
                            ${imgTag(item.getimg1)}
                            ${imgTag(item.getimg2)}
                        </div>
                    </div>`;
            }
            if (item.dsec || item.dsecimg1 || item.dsecimg2) {
                bodyHtml += `
                    <div class="cd-section">
                        <h3 class="cd-subtitle">ìƒì„¸ ë‚´ìš©</h3>
                        <p class="cd-text">${item.dsec || ''}</p>
                        <div class="cd-img-container ${item.dsecimg1 && item.dsecimg2 ? 'grid-2' : ''}">
                            ${imgTag(item.dsecimg1)}
                            ${imgTag(item.dsecimg2)}
                        </div>
                    </div>`;
            }
            if (!item.get && !item.dsec && !item.getimg1 && !item.dsecimg1) {
                const descText = item.content || item.desc || "ìƒì„¸ ë‚´ìš©ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.";
                bodyHtml += `
                    <div class="cd-section">
                        <h3 class="cd-subtitle">ì„¤ëª…</h3>
                        <p class="cd-text">${descText}</p>
                        ${item.image ? `<img src="${item.image}" class="cd-img mt-2">` : ''}
                    </div>`;
            }

            let html = `
                <div class="chunji-detail-card">
                    <div class="cd-header">
                        <span class="cd-badge">ì²œì§€ë¡</span>
                        <h2 class="cd-title">${item.title}</h2>
                    </div>
                    ${bodyHtml}
                </div>
            `;

            const allIds = chunjiData.map(c => c.id);
            const currIdx = allIds.indexOf(String(id));

            let navHtml = '<div class="nav-btn-row">';
            if (currIdx > 0) {
                navHtml += `<button onclick="renderChunjiDetailOverride('${allIds[currIdx - 1]}')" class="nav-move-btn"><span class="text-lg">â†</span> ì´ì „</button>`;
            } else { navHtml += `<div></div>`; }

            if (currIdx < allIds.length - 1) {
                navHtml += `<button onclick="renderChunjiDetailOverride('${allIds[currIdx + 1]}')" class="nav-move-btn">ë‹¤ìŒ <span class="text-lg">â†’</span></button>`;
            } else { navHtml += `<div></div>`; }
            navHtml += '</div>';

            document.getElementById('chunji-detail-content').innerHTML = html + navHtml;
        };
        window.loadChunjiDetail = window.renderChunjiDetailOverride;
        window.showChunjiDetail = window.renderChunjiDetailOverride;


        // [â˜…ìˆ˜ì •] ì²œì§€ë¡ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ - ë‹¨ìˆœ ë¦¬ìŠ¤íŠ¸ í˜•íƒœ
        window.renderChunjiListOverride = function() {
            const container = document.getElementById('chunji-list-container');
            if(!container) return;
            container.innerHTML = '';
            
            let filtered = chunjiData;
            if(typeof chunjiData === 'undefined') return;

            const typeFilter = document.getElementById('chunji-type-select').value;
            const subFilter = document.getElementById('chunji-subtype-select').value;

            filtered = chunjiData.filter(item => {
                if(typeFilter !== 'all' && item.type !== typeFilter) return false;
                if(subFilter !== 'all' && item.subtype !== subFilter) return false; 
                return true;
            });

            filtered.forEach(item => {
                const div = document.createElement('div');
                div.className = 'chunji-item-card'; 
                div.onclick = function() { renderChunjiDetailOverride(item.id); }; 
                div.innerHTML = `<span class="chunji-card-title">${item.title}</span>`;
                container.appendChild(div);
            });
        };
        window.renderChunjiList = window.renderChunjiListOverride;

        // [â˜…ìˆ˜ì •] í™ˆ í™”ë©´ìš© ì²œì§€ë¡ ë Œë”ë§
        window.renderHomeChunjiOverride = function() {
            const container = document.getElementById('home-chunji-list');
            if (!container || !chunjiData) return;
            container.innerHTML = '';
            const displayList = chunjiData.slice(0, 6);
            displayList.forEach(item => {
                const div = document.createElement('div');
                div.className = 'chunji-item-card';
                div.onclick = () => {
                    if (typeof switchTab === 'function') {
                        switchTab('chunji');
                        renderChunjiDetailOverride(item.id);
                    }
                };
                div.innerHTML = `<span class="chunji-card-title">${item.title}</span>`;
                container.appendChild(div);
            });
        };
        window.renderHomeChunji = window.renderHomeChunjiOverride;
        
        // [â˜…ì¶”ê°€] íƒ€ì´ë¨¸ ì˜¤ë²„ë¼ì´ë“œ: ì•„ì´ì½˜/í…ìŠ¤íŠ¸ ìˆœì„œ ë³€ê²½ & [0/4] ì¶”ê°€
        window.updateTimers = function() {
            const container = document.getElementById('gangho-timer-list');
            if (!container) return; 

            if (container.children.length === 0 || container.innerText.includes('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘')) {
                container.innerHTML = '';
            }

            const now = new Date();
            const statusData = getCheckStatus(); // timer.jsì˜ í•¨ìˆ˜

            const serverTimeEl = document.getElementById('server-time');
            if (serverTimeEl) serverTimeEl.innerText = now.toTimeString().split(' ')[0];

            TIMERS.forEach(timer => {
                let row = document.getElementById(`timer-card-${timer.id}`);
                
                if (!row) {
                    row = document.createElement('div');
                    row.id = `timer-card-${timer.id}`;
                    row.className = 'timer-row';
                    row.onclick = function() { openTimerSheet(timer); };
                    container.appendChild(row);
                }

                let timeText = "";
                let isUrgent = false;
                let progressText = ""; // í…ìŠ¤íŠ¸ í˜•íƒœ ì§„í–‰ë„

                if (timer.type === 'reset') {
                    const target = getNextReset(timer.freq, now);
                    const diff = target - now;
                    timeText = formatTime(diff);
                    if (diff < 3 * 60 * 60 * 1000) isUrgent = true;

                    // ì§„í–‰ë„ í…ìŠ¤íŠ¸ ê³„ì‚°
                    const tasks = TASK_DATA.filter(t => t.freq === timer.freq);
                    if (tasks.length > 0) {
                        const done = tasks.filter(t => statusData.checked[t.id]).length;
                        progressText = `<span class="timer-progress-text">[${done}/${tasks.length}]</span>`;
                        if (done === tasks.length) row.style.opacity = "0.6";
                        else row.style.opacity = "1";
                    }
                } 
                else if (timer.type === 'daily_operating') {
                    const h = now.getHours();
                    if (h >= 5 && h < 7) timeText = "íœ´ì¥ ì¤‘";
                    else timeText = "ìš´ì˜ ì¤‘";
                }
                else {
                    timeText = "ì‹œê°„ í™•ì¸";
                }

                // [ìˆ˜ì •ëœ HTML êµ¬ì¡°] ì•„ì´ì½˜(ê°€ìƒìš”ì†Œ) -> ì§„í–‰ë„ -> ì œëª©
                row.innerHTML = `
                    <div class="timer-info">
                        <div class="timer-name">
                            ${progressText}
                            ${timer.name}
                        </div>
                        <div class="timer-desc">
                            <span>${timer.desc}</span>
                        </div>
                    </div>
                    <div class="timer-clock ${isUrgent ? 'urgent' : ''}">${timeText}</div>
                `;
            });
            
            // íƒ­ ë™ê¸°í™”
            const tabList = document.getElementById('gangho-timer-list-tab');
            if(tabList) tabList.innerHTML = container.innerHTML;
        };

        // [â˜…ì¶”ê°€] ë§Œì‚¬ë¡ ë¦¬ìŠ¤íŠ¸ì— ì§€ì—­ ë±ƒì§€ ì¶”ê°€ (overriding renderMansarok)
        async function loadMansarokMenu() {
            try {
                const response = await fetch('json/quests.json');
                if (!response.ok) throw new Error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');

                const data = await response.json();
                
                const mansarokContainer = document.getElementById('mansarok-list');
                const isPc = window.innerWidth >= 1024; 
                const limit = isPc ? 18 : 6;

                if (mansarokContainer) {
                    const mansarokList = data
                        .filter(item => !['ì§€ê³¼', 'ë³´ìŠ¤ ê³µëµ'].includes(item.type))
                        .slice(0, limit);

                    mansarokContainer.innerHTML = '';

                    mansarokList.forEach(item => {
                        const btn = document.createElement('a');
                        btn.className = 'mansarok-btn';
                        btn.href = "javascript:void(0);";
                        btn.onclick = () => {
                            switchTab('quest');
                            loadQuestDetail(item.filepath, item.id);
                        };
                        
                        // [â˜…ìˆ˜ì •] ì§€ì—­ ë±ƒì§€ ì¶”ê°€
                        const locBadge = item.location ? `<span class="list-loc-badge">[${item.location}]</span>` : '';
                        
                        btn.innerHTML = `${locBadge}<span>${item.name}</span>`;
                        mansarokContainer.appendChild(btn);
                    });
                }
            } catch (error) {
                console.error('ë§Œì‚¬ë¡ ë¡œë“œ ì—ëŸ¬:', error);
            }
        }
        // DOMContentLoadedì—ì„œ loadMansarokMenuê°€ í˜¸ì¶œë˜ë¯€ë¡œ, ì—¬ê¸°ì„œ ë®ì–´ì“°ì§€ ì•Šê³  
        // ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆê°€ ì‹¤í–‰ë˜ê²Œ ë‘ . ë‹¨, ìœ„ í•¨ìˆ˜ ì •ì˜ë¡œ ì¸í•´ í˜¸ì´ìŠ¤íŒ… ë˜ê±°ë‚˜ ë®ì–´ì¨ì§.

        window.switchTab = function(tabName) {
            // í—¤ë”ê°€ í•­ìƒ ë³´ì´ë„ë¡ ì„¤ì •
            const header = document.getElementById('main-header');
            if (header) {
                header.style.removeProperty('display');
                if (getComputedStyle(header).display === 'none') header.style.display = 'flex';
            }
            
            const views = ['view-home', 'view-quest', 'view-chunji', 'view-quiz', 'view-archive', 'view-news', 'view-guide', 'view-code', 'view-builder', 'view-map-detail', 'view-todo'];
            views.forEach(v => { 
                const el = document.getElementById(v);
                if(el) el.style.display = (v === 'view-' + tabName) ? 'block' : 'none'; 
            });
            
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.getElementById('nav-' + tabName);
            if(activeBtn) activeBtn.classList.add('active');
            
            if (tabName === 'todo' && typeof updateTimers === 'function') {
                updateTimers();
            }
            else if (tabName === 'quiz') {
                const tbody = document.getElementById('quiz-table-body');
                if (typeof globalData !== 'undefined' && globalData.quiz && tbody && tbody.children.length === 0) {
                    if(typeof renderQuizTable === 'function') renderQuizTable(globalData.quiz);
                    if(typeof updateQuizCounter === 'function') updateQuizCounter();
                }
            } else if (tabName === 'quest') {
                const container = document.getElementById('quest-grid-container');
                if (typeof globalData !== 'undefined' && globalData.quests && container && container.children.length === 0) {
                    if(typeof renderQuestList === 'function') renderQuestList();
                }
                if(typeof showQuestList === 'function') showQuestList();
            } else if (tabName === 'chunji') {
                if(typeof renderChunjiListOverride === 'function') {
                    renderChunjiListOverride(); 
                } else if(typeof renderChunjiList === 'function') {
                    renderChunjiList();
                }
                if(typeof showChunjiList === 'function') showChunjiList();
            }
            
            window.scrollTo(0, 0);
            if (typeof updateUrlQuery === 'function') {
                updateUrlQuery(tabName);
            }
        };

        setInterval(function() {
            if (typeof updateTimers === 'function') {
                updateTimers();
            }
        }, 1000);
        
        window.addEventListener('DOMContentLoaded', () => {
             if(typeof renderHomeChunjiOverride === 'function') renderHomeChunjiOverride();
        });
    </script>
</body>
</html>
